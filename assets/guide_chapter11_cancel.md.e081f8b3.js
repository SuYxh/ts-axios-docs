import{_ as s,c as n,o as a,a as l}from"./app.494a6664.js";const i=JSON.parse('{"title":"\u8BF7\u6C42\u53D6\u6D88\u6A21\u5757\u5355\u5143\u6D4B\u8BD5","description":"","frontmatter":{},"headers":[{"level":2,"title":"Cancel \u7C7B\u5355\u5143\u6D4B\u8BD5","slug":"cancel-\u7C7B\u5355\u5143\u6D4B\u8BD5","link":"#cancel-\u7C7B\u5355\u5143\u6D4B\u8BD5","children":[]},{"level":2,"title":"CancelToken \u7C7B\u5355\u5143\u6D4B\u8BD5","slug":"canceltoken-\u7C7B\u5355\u5143\u6D4B\u8BD5","link":"#canceltoken-\u7C7B\u5355\u5143\u6D4B\u8BD5","children":[]},{"level":2,"title":"Cancel \u4E1A\u52A1\u903B\u8F91\u5355\u5143\u6D4B\u8BD5","slug":"cancel-\u4E1A\u52A1\u903B\u8F91\u5355\u5143\u6D4B\u8BD5","link":"#cancel-\u4E1A\u52A1\u903B\u8F91\u5355\u5143\u6D4B\u8BD5","children":[]}],"relativePath":"guide/chapter11/cancel.md"}'),p={name:"guide/chapter11/cancel.md"},o=l(`<h1 id="\u8BF7\u6C42\u53D6\u6D88\u6A21\u5757\u5355\u5143\u6D4B\u8BD5" tabindex="-1">\u8BF7\u6C42\u53D6\u6D88\u6A21\u5757\u5355\u5143\u6D4B\u8BD5 <a class="header-anchor" href="#\u8BF7\u6C42\u53D6\u6D88\u6A21\u5757\u5355\u5143\u6D4B\u8BD5" aria-hidden="true">#</a></h1><p>\u8BF7\u6C42\u53D6\u6D88\u6A21\u5757\u662F <code>ts-axios</code> \u5E93\u6838\u5FC3\u6D41\u7A0B\u5176\u4E2D\u4E00\u4E2A\u5206\u652F\uFF0C\u4E5F\u662F\u975E\u5E38\u91CD\u8981\u7684\u6A21\u5757\uFF0C\u6211\u4EEC\u5C06\u4ECE\u57FA\u7840\u5E93\u548C\u4E1A\u52A1\u6D41\u7A0B\u6A21\u5757 2 \u4E2A\u65B9\u9762\u53BB\u7F16\u5199\u5355\u5143\u6D4B\u8BD5\u3002</p><h2 id="cancel-\u7C7B\u5355\u5143\u6D4B\u8BD5" tabindex="-1">Cancel \u7C7B\u5355\u5143\u6D4B\u8BD5 <a class="header-anchor" href="#cancel-\u7C7B\u5355\u5143\u6D4B\u8BD5" aria-hidden="true">#</a></h2><p><code>cancel/Cancel.spec.ts</code>\uFF1A</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Cancel</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">isCancel</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">from</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">../../src/cancel/Cancel</span><span style="color:#C98A7DAA;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#80A665;">describe</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">cancel:Cancel</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">test</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">should returns correct result when message is specified</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const </span><span style="color:#BD976A;">cancel</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> new </span><span style="color:#80A665;">Cancel</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Operation has been canceled.</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#BD976A;">cancel</span><span style="color:#666666;">.</span><span style="color:#BD976A;">message</span><span style="color:#666666;">).</span><span style="color:#80A665;">toBe</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Operation has been canceled.</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">test</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">should returns true if value is a Cancel</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#80A665;">isCancel</span><span style="color:#666666;">(</span><span style="color:#CB7676;">new</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">Cancel</span><span style="color:#666666;">())).</span><span style="color:#80A665;">toBeTruthy</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">test</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">should returns false if value is not a Cancel</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#80A665;">isCancel</span><span style="color:#666666;">({</span><span style="color:#DBD7CAEE;"> </span><span style="color:#B8A965;">foo</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">bar</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">})).</span><span style="color:#80A665;">toBeFalsy</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#666666;">})</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Cancel</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">isCancel</span><span style="color:#393A34;"> </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">../../src/cancel/Cancel</span><span style="color:#B56959AA;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;">describe</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">cancel:Cancel</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">test</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">should returns correct result when message is specified</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const </span><span style="color:#B07D48;">cancel</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> new </span><span style="color:#59873A;">Cancel</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Operation has been canceled.</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#B07D48;">cancel</span><span style="color:#999999;">.</span><span style="color:#B07D48;">message</span><span style="color:#999999;">).</span><span style="color:#59873A;">toBe</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Operation has been canceled.</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">test</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">should returns true if value is a Cancel</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#59873A;">isCancel</span><span style="color:#999999;">(</span><span style="color:#AB5959;">new</span><span style="color:#393A34;"> </span><span style="color:#59873A;">Cancel</span><span style="color:#999999;">())).</span><span style="color:#59873A;">toBeTruthy</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">test</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">should returns false if value is not a Cancel</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#59873A;">isCancel</span><span style="color:#999999;">({</span><span style="color:#393A34;"> </span><span style="color:#998418;">foo</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">bar</span><span style="color:#B56959AA;">&#39;</span><span style="color:#393A34;"> </span><span style="color:#999999;">})).</span><span style="color:#59873A;">toBeFalsy</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#999999;">})</span></span>
<span class="line"></span></code></pre></div><h2 id="canceltoken-\u7C7B\u5355\u5143\u6D4B\u8BD5" tabindex="-1">CancelToken \u7C7B\u5355\u5143\u6D4B\u8BD5 <a class="header-anchor" href="#canceltoken-\u7C7B\u5355\u5143\u6D4B\u8BD5" aria-hidden="true">#</a></h2><p><code>cancel/CancelToken.spec.ts</code>\uFF1A</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">CancelToken</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">from</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">../../src/cancel/CancelToken</span><span style="color:#C98A7DAA;">&#39;</span></span>
<span class="line"><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Cancel</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">from</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">../../src/cancel/Cancel</span><span style="color:#C98A7DAA;">&#39;</span></span>
<span class="line"><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Canceler</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">from</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">../../src/types</span><span style="color:#C98A7DAA;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#80A665;">describe</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">CancelToken</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">describe</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">reason</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">test</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">should returns a Cancel if cancellation has been requested</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#CB7676;">let </span><span style="color:#BD976A;">cancel</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Canceler</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#CB7676;">let </span><span style="color:#BD976A;">token</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> new </span><span style="color:#80A665;">CancelToken</span><span style="color:#666666;">(</span><span style="color:#BD976A;">c</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#CB7676;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#CB7676;">        </span><span style="color:#BD976A;">cancel</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">c</span></span>
<span class="line"><span style="color:#CB7676;">      </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#80A665;">cancel</span><span style="color:#CB7676;">!</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Operation has been canceled.</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#BD976A;">token</span><span style="color:#666666;">.</span><span style="color:#BD976A;">reason</span><span style="color:#666666;">).</span><span style="color:#80A665;">toEqual</span><span style="color:#666666;">(</span><span style="color:#BD976A;">expect</span><span style="color:#666666;">.</span><span style="color:#80A665;">any</span><span style="color:#666666;">(</span><span style="color:#BD976A;">Cancel</span><span style="color:#666666;">))</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#BD976A;">token</span><span style="color:#666666;">.</span><span style="color:#BD976A;">reason</span><span style="color:#CB7676;">!</span><span style="color:#666666;">.</span><span style="color:#BD976A;">message</span><span style="color:#666666;">).</span><span style="color:#80A665;">toBe</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Operation has been canceled.</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">test</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">should has no side effect if call cancellation for multi times</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#CB7676;">let </span><span style="color:#BD976A;">cancel</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Canceler</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#CB7676;">let </span><span style="color:#BD976A;">token</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> new </span><span style="color:#80A665;">CancelToken</span><span style="color:#666666;">(</span><span style="color:#BD976A;">c</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#CB7676;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#CB7676;">        </span><span style="color:#BD976A;">cancel</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">c</span></span>
<span class="line"><span style="color:#CB7676;">      </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#80A665;">cancel</span><span style="color:#CB7676;">!</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Operation has been canceled.</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#80A665;">cancel</span><span style="color:#CB7676;">!</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Operation has been canceled.</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#BD976A;">token</span><span style="color:#666666;">.</span><span style="color:#BD976A;">reason</span><span style="color:#666666;">).</span><span style="color:#80A665;">toEqual</span><span style="color:#666666;">(</span><span style="color:#BD976A;">expect</span><span style="color:#666666;">.</span><span style="color:#80A665;">any</span><span style="color:#666666;">(</span><span style="color:#BD976A;">Cancel</span><span style="color:#666666;">))</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#BD976A;">token</span><span style="color:#666666;">.</span><span style="color:#BD976A;">reason</span><span style="color:#CB7676;">!</span><span style="color:#666666;">.</span><span style="color:#BD976A;">message</span><span style="color:#666666;">).</span><span style="color:#80A665;">toBe</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Operation has been canceled.</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">test</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">should returns undefined if cancellation has not been requested</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#CB7676;">const </span><span style="color:#BD976A;">token</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> new </span><span style="color:#80A665;">CancelToken</span><span style="color:#666666;">(()</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#CB7676;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// do nothing</span></span>
<span class="line"><span style="color:#CB7676;">      </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#BD976A;">token</span><span style="color:#666666;">.</span><span style="color:#BD976A;">reason</span><span style="color:#666666;">).</span><span style="color:#80A665;">toBeUndefined</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">describe</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">promise</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">test</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">should returns a Promise that resolves when cancellation is requested</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">done</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#CB7676;">let </span><span style="color:#BD976A;">cancel</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Canceler</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#CB7676;">const </span><span style="color:#BD976A;">token</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> new </span><span style="color:#80A665;">CancelToken</span><span style="color:#666666;">(</span><span style="color:#BD976A;">c</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#CB7676;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#CB7676;">        </span><span style="color:#BD976A;">cancel</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">c</span></span>
<span class="line"><span style="color:#CB7676;">      </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#BD976A;">token</span><span style="color:#666666;">.</span><span style="color:#BD976A;">promise</span><span style="color:#666666;">.</span><span style="color:#80A665;">then</span><span style="color:#666666;">(</span><span style="color:#BD976A;">value</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#BD976A;">value</span><span style="color:#666666;">).</span><span style="color:#80A665;">toEqual</span><span style="color:#666666;">(</span><span style="color:#BD976A;">expect</span><span style="color:#666666;">.</span><span style="color:#80A665;">any</span><span style="color:#666666;">(</span><span style="color:#BD976A;">Cancel</span><span style="color:#666666;">))</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#BD976A;">value</span><span style="color:#666666;">.</span><span style="color:#BD976A;">message</span><span style="color:#666666;">).</span><span style="color:#80A665;">toBe</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Operation has been canceled.</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#80A665;">done</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#80A665;">cancel</span><span style="color:#CB7676;">!</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Operation has been canceled.</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">describe</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">throwIfRequested</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">test</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">should throws if cancellation has been requested</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#CB7676;">let </span><span style="color:#BD976A;">cancel</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Canceler</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#CB7676;">const </span><span style="color:#BD976A;">token</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> new </span><span style="color:#80A665;">CancelToken</span><span style="color:#666666;">(</span><span style="color:#BD976A;">c</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#CB7676;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#CB7676;">        </span><span style="color:#BD976A;">cancel</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">c</span></span>
<span class="line"><span style="color:#CB7676;">      </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#80A665;">cancel</span><span style="color:#CB7676;">!</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Operation has been canceled.</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">try</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">token</span><span style="color:#666666;">.</span><span style="color:#80A665;">throwIfRequested</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#80A665;">fail</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Expected throwIfRequested to throw.</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">catch</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">thrown</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#CB7676;">!</span><span style="color:#666666;">(</span><span style="color:#BD976A;">thrown</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">instanceof</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">Cancel</span><span style="color:#666666;">))</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#80A665;">fail</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Expected throwIfRequested to throw a Cancel, but test threw </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">+</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">thrown</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">+</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">.</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#BD976A;">thrown</span><span style="color:#666666;">.</span><span style="color:#BD976A;">message</span><span style="color:#666666;">).</span><span style="color:#80A665;">toBe</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Operation has been canceled.</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">test</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">should does not throw if cancellation has not been requested</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#CB7676;">const </span><span style="color:#BD976A;">token</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> new </span><span style="color:#80A665;">CancelToken</span><span style="color:#666666;">(()</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#CB7676;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// do nothing</span></span>
<span class="line"><span style="color:#CB7676;">      </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#BD976A;">token</span><span style="color:#666666;">.</span><span style="color:#80A665;">throwIfRequested</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">describe</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">source</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">test</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">should returns an object containing token and cancel function</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#CB7676;">const </span><span style="color:#BD976A;">source</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">CancelToken</span><span style="color:#666666;">.</span><span style="color:#80A665;">source</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#BD976A;">source</span><span style="color:#666666;">.</span><span style="color:#BD976A;">token</span><span style="color:#666666;">).</span><span style="color:#80A665;">toEqual</span><span style="color:#666666;">(</span><span style="color:#BD976A;">expect</span><span style="color:#666666;">.</span><span style="color:#80A665;">any</span><span style="color:#666666;">(</span><span style="color:#BD976A;">CancelToken</span><span style="color:#666666;">))</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#BD976A;">source</span><span style="color:#666666;">.</span><span style="color:#BD976A;">cancel</span><span style="color:#666666;">).</span><span style="color:#80A665;">toEqual</span><span style="color:#666666;">(</span><span style="color:#BD976A;">expect</span><span style="color:#666666;">.</span><span style="color:#80A665;">any</span><span style="color:#666666;">(</span><span style="color:#BD976A;">Function</span><span style="color:#666666;">))</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#BD976A;">source</span><span style="color:#666666;">.</span><span style="color:#BD976A;">token</span><span style="color:#666666;">.</span><span style="color:#BD976A;">reason</span><span style="color:#666666;">).</span><span style="color:#80A665;">toBeUndefined</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#BD976A;">source</span><span style="color:#666666;">.</span><span style="color:#80A665;">cancel</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Operation has been canceled.</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#BD976A;">source</span><span style="color:#666666;">.</span><span style="color:#BD976A;">token</span><span style="color:#666666;">.</span><span style="color:#BD976A;">reason</span><span style="color:#666666;">).</span><span style="color:#80A665;">toEqual</span><span style="color:#666666;">(</span><span style="color:#BD976A;">expect</span><span style="color:#666666;">.</span><span style="color:#80A665;">any</span><span style="color:#666666;">(</span><span style="color:#BD976A;">Cancel</span><span style="color:#666666;">))</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#BD976A;">source</span><span style="color:#666666;">.</span><span style="color:#BD976A;">token</span><span style="color:#666666;">.</span><span style="color:#BD976A;">reason</span><span style="color:#CB7676;">!</span><span style="color:#666666;">.</span><span style="color:#BD976A;">message</span><span style="color:#666666;">).</span><span style="color:#80A665;">toBe</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Operation has been canceled.</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#666666;">})</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">CancelToken</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">../../src/cancel/CancelToken</span><span style="color:#B56959AA;">&#39;</span></span>
<span class="line"><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Cancel</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">../../src/cancel/Cancel</span><span style="color:#B56959AA;">&#39;</span></span>
<span class="line"><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Canceler</span><span style="color:#393A34;"> </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">../../src/types</span><span style="color:#B56959AA;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;">describe</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">CancelToken</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">describe</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">reason</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">test</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">should returns a Cancel if cancellation has been requested</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#AB5959;">let </span><span style="color:#B07D48;">cancel</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Canceler</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#AB5959;">let </span><span style="color:#B07D48;">token</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> new </span><span style="color:#59873A;">CancelToken</span><span style="color:#999999;">(</span><span style="color:#B07D48;">c</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#AB5959;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#AB5959;">        </span><span style="color:#B07D48;">cancel</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">c</span></span>
<span class="line"><span style="color:#AB5959;">      </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#59873A;">cancel</span><span style="color:#AB5959;">!</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Operation has been canceled.</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#B07D48;">token</span><span style="color:#999999;">.</span><span style="color:#B07D48;">reason</span><span style="color:#999999;">).</span><span style="color:#59873A;">toEqual</span><span style="color:#999999;">(</span><span style="color:#B07D48;">expect</span><span style="color:#999999;">.</span><span style="color:#59873A;">any</span><span style="color:#999999;">(</span><span style="color:#B07D48;">Cancel</span><span style="color:#999999;">))</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#B07D48;">token</span><span style="color:#999999;">.</span><span style="color:#B07D48;">reason</span><span style="color:#AB5959;">!</span><span style="color:#999999;">.</span><span style="color:#B07D48;">message</span><span style="color:#999999;">).</span><span style="color:#59873A;">toBe</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Operation has been canceled.</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">test</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">should has no side effect if call cancellation for multi times</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#AB5959;">let </span><span style="color:#B07D48;">cancel</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Canceler</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#AB5959;">let </span><span style="color:#B07D48;">token</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> new </span><span style="color:#59873A;">CancelToken</span><span style="color:#999999;">(</span><span style="color:#B07D48;">c</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#AB5959;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#AB5959;">        </span><span style="color:#B07D48;">cancel</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">c</span></span>
<span class="line"><span style="color:#AB5959;">      </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#59873A;">cancel</span><span style="color:#AB5959;">!</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Operation has been canceled.</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#59873A;">cancel</span><span style="color:#AB5959;">!</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Operation has been canceled.</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#B07D48;">token</span><span style="color:#999999;">.</span><span style="color:#B07D48;">reason</span><span style="color:#999999;">).</span><span style="color:#59873A;">toEqual</span><span style="color:#999999;">(</span><span style="color:#B07D48;">expect</span><span style="color:#999999;">.</span><span style="color:#59873A;">any</span><span style="color:#999999;">(</span><span style="color:#B07D48;">Cancel</span><span style="color:#999999;">))</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#B07D48;">token</span><span style="color:#999999;">.</span><span style="color:#B07D48;">reason</span><span style="color:#AB5959;">!</span><span style="color:#999999;">.</span><span style="color:#B07D48;">message</span><span style="color:#999999;">).</span><span style="color:#59873A;">toBe</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Operation has been canceled.</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">test</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">should returns undefined if cancellation has not been requested</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#AB5959;">const </span><span style="color:#B07D48;">token</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> new </span><span style="color:#59873A;">CancelToken</span><span style="color:#999999;">(()</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#AB5959;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// do nothing</span></span>
<span class="line"><span style="color:#AB5959;">      </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#B07D48;">token</span><span style="color:#999999;">.</span><span style="color:#B07D48;">reason</span><span style="color:#999999;">).</span><span style="color:#59873A;">toBeUndefined</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">describe</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">promise</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">test</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">should returns a Promise that resolves when cancellation is requested</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">done</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#AB5959;">let </span><span style="color:#B07D48;">cancel</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Canceler</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#AB5959;">const </span><span style="color:#B07D48;">token</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> new </span><span style="color:#59873A;">CancelToken</span><span style="color:#999999;">(</span><span style="color:#B07D48;">c</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#AB5959;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#AB5959;">        </span><span style="color:#B07D48;">cancel</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">c</span></span>
<span class="line"><span style="color:#AB5959;">      </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#B07D48;">token</span><span style="color:#999999;">.</span><span style="color:#B07D48;">promise</span><span style="color:#999999;">.</span><span style="color:#59873A;">then</span><span style="color:#999999;">(</span><span style="color:#B07D48;">value</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#B07D48;">value</span><span style="color:#999999;">).</span><span style="color:#59873A;">toEqual</span><span style="color:#999999;">(</span><span style="color:#B07D48;">expect</span><span style="color:#999999;">.</span><span style="color:#59873A;">any</span><span style="color:#999999;">(</span><span style="color:#B07D48;">Cancel</span><span style="color:#999999;">))</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#B07D48;">value</span><span style="color:#999999;">.</span><span style="color:#B07D48;">message</span><span style="color:#999999;">).</span><span style="color:#59873A;">toBe</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Operation has been canceled.</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#59873A;">done</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#59873A;">cancel</span><span style="color:#AB5959;">!</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Operation has been canceled.</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">describe</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">throwIfRequested</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">test</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">should throws if cancellation has been requested</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#AB5959;">let </span><span style="color:#B07D48;">cancel</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Canceler</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#AB5959;">const </span><span style="color:#B07D48;">token</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> new </span><span style="color:#59873A;">CancelToken</span><span style="color:#999999;">(</span><span style="color:#B07D48;">c</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#AB5959;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#AB5959;">        </span><span style="color:#B07D48;">cancel</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">c</span></span>
<span class="line"><span style="color:#AB5959;">      </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#59873A;">cancel</span><span style="color:#AB5959;">!</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Operation has been canceled.</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">try</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">token</span><span style="color:#999999;">.</span><span style="color:#59873A;">throwIfRequested</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#59873A;">fail</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Expected throwIfRequested to throw.</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">catch</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">thrown</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#AB5959;">!</span><span style="color:#999999;">(</span><span style="color:#B07D48;">thrown</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">instanceof</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">Cancel</span><span style="color:#999999;">))</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#59873A;">fail</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Expected throwIfRequested to throw a Cancel, but test threw </span><span style="color:#B56959AA;">&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">+</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">thrown</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">+</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">.</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#B07D48;">thrown</span><span style="color:#999999;">.</span><span style="color:#B07D48;">message</span><span style="color:#999999;">).</span><span style="color:#59873A;">toBe</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Operation has been canceled.</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">test</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">should does not throw if cancellation has not been requested</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#AB5959;">const </span><span style="color:#B07D48;">token</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> new </span><span style="color:#59873A;">CancelToken</span><span style="color:#999999;">(()</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#AB5959;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// do nothing</span></span>
<span class="line"><span style="color:#AB5959;">      </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#B07D48;">token</span><span style="color:#999999;">.</span><span style="color:#59873A;">throwIfRequested</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">describe</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">source</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">test</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">should returns an object containing token and cancel function</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#AB5959;">const </span><span style="color:#B07D48;">source</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">CancelToken</span><span style="color:#999999;">.</span><span style="color:#59873A;">source</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#B07D48;">source</span><span style="color:#999999;">.</span><span style="color:#B07D48;">token</span><span style="color:#999999;">).</span><span style="color:#59873A;">toEqual</span><span style="color:#999999;">(</span><span style="color:#B07D48;">expect</span><span style="color:#999999;">.</span><span style="color:#59873A;">any</span><span style="color:#999999;">(</span><span style="color:#B07D48;">CancelToken</span><span style="color:#999999;">))</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#B07D48;">source</span><span style="color:#999999;">.</span><span style="color:#B07D48;">cancel</span><span style="color:#999999;">).</span><span style="color:#59873A;">toEqual</span><span style="color:#999999;">(</span><span style="color:#B07D48;">expect</span><span style="color:#999999;">.</span><span style="color:#59873A;">any</span><span style="color:#999999;">(</span><span style="color:#B07D48;">Function</span><span style="color:#999999;">))</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#B07D48;">source</span><span style="color:#999999;">.</span><span style="color:#B07D48;">token</span><span style="color:#999999;">.</span><span style="color:#B07D48;">reason</span><span style="color:#999999;">).</span><span style="color:#59873A;">toBeUndefined</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#B07D48;">source</span><span style="color:#999999;">.</span><span style="color:#59873A;">cancel</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Operation has been canceled.</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#B07D48;">source</span><span style="color:#999999;">.</span><span style="color:#B07D48;">token</span><span style="color:#999999;">.</span><span style="color:#B07D48;">reason</span><span style="color:#999999;">).</span><span style="color:#59873A;">toEqual</span><span style="color:#999999;">(</span><span style="color:#B07D48;">expect</span><span style="color:#999999;">.</span><span style="color:#59873A;">any</span><span style="color:#999999;">(</span><span style="color:#B07D48;">Cancel</span><span style="color:#999999;">))</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#B07D48;">source</span><span style="color:#999999;">.</span><span style="color:#B07D48;">token</span><span style="color:#999999;">.</span><span style="color:#B07D48;">reason</span><span style="color:#AB5959;">!</span><span style="color:#999999;">.</span><span style="color:#B07D48;">message</span><span style="color:#999999;">).</span><span style="color:#59873A;">toBe</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Operation has been canceled.</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#999999;">})</span></span>
<span class="line"></span></code></pre></div><p>\u6CE8\u610F\uFF0C\u8FD9\u91CC\u6211\u4EEC\u4F7F\u7528\u4E86 <code>fail</code> \u51FD\u6570\u8868\u793A\u4E00\u4E2A\u6D4B\u8BD5\u7684\u5931\u8D25\uFF0C\u8FD9\u4E2A\u5E76\u672A\u5728 Jest \u6587\u6863\u4E2D\u4F53\u73B0\uFF0C\u4F46\u5B83\u662F\u4E00\u4E2A\u53EF\u4EE5\u7528\u7684 API\u3002</p><h2 id="cancel-\u4E1A\u52A1\u903B\u8F91\u5355\u5143\u6D4B\u8BD5" tabindex="-1">Cancel \u4E1A\u52A1\u903B\u8F91\u5355\u5143\u6D4B\u8BD5 <a class="header-anchor" href="#cancel-\u4E1A\u52A1\u903B\u8F91\u5355\u5143\u6D4B\u8BD5" aria-hidden="true">#</a></h2><p><code>cancel.spec.ts</code>\uFF1A</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">axios</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">from</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">../src/index</span><span style="color:#C98A7DAA;">&#39;</span></span>
<span class="line"><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">getAjaxRequest</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">from</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">./helper</span><span style="color:#C98A7DAA;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#80A665;">describe</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">cancel</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#CB7676;">const </span><span style="color:#BD976A;">CancelToken</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">axios</span><span style="color:#666666;">.</span><span style="color:#BD976A;">CancelToken</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#CB7676;">const </span><span style="color:#BD976A;">Cancel</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">axios</span><span style="color:#666666;">.</span><span style="color:#BD976A;">Cancel</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">beforeEach</span><span style="color:#666666;">(()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">jasmine</span><span style="color:#666666;">.</span><span style="color:#BD976A;">Ajax</span><span style="color:#666666;">.</span><span style="color:#80A665;">install</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">afterEach</span><span style="color:#666666;">(()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">jasmine</span><span style="color:#666666;">.</span><span style="color:#BD976A;">Ajax</span><span style="color:#666666;">.</span><span style="color:#80A665;">uninstall</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">describe</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">when called before sending request</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">test</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">should rejects Promise with a Cancel object</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#CB7676;">const </span><span style="color:#BD976A;">source</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">CancelToken</span><span style="color:#666666;">.</span><span style="color:#80A665;">source</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#BD976A;">source</span><span style="color:#666666;">.</span><span style="color:#80A665;">cancel</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Operation has been canceled.</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">axios</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">.</span><span style="color:#80A665;">get</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">/foo</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#B8A965;">cancelToken</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">source</span><span style="color:#666666;">.</span><span style="color:#BD976A;">token</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">.</span><span style="color:#80A665;">catch</span><span style="color:#666666;">(</span><span style="color:#BD976A;">reason</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#BD976A;">reason</span><span style="color:#666666;">).</span><span style="color:#80A665;">toEqual</span><span style="color:#666666;">(</span><span style="color:#BD976A;">expect</span><span style="color:#666666;">.</span><span style="color:#80A665;">any</span><span style="color:#666666;">(</span><span style="color:#BD976A;">Cancel</span><span style="color:#666666;">))</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#BD976A;">reason</span><span style="color:#666666;">.</span><span style="color:#BD976A;">message</span><span style="color:#666666;">).</span><span style="color:#80A665;">toBe</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Operation has been canceled.</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">describe</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">when called after request has been sent</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">test</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">should rejects Promise with a Cancel object</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">done</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#CB7676;">const </span><span style="color:#BD976A;">source</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">CancelToken</span><span style="color:#666666;">.</span><span style="color:#80A665;">source</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#BD976A;">axios</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">.</span><span style="color:#80A665;">get</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">/foo/bar</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#B8A965;">cancelToken</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">source</span><span style="color:#666666;">.</span><span style="color:#BD976A;">token</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">.</span><span style="color:#80A665;">catch</span><span style="color:#666666;">(</span><span style="color:#BD976A;">reason</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#BD976A;">reason</span><span style="color:#666666;">).</span><span style="color:#80A665;">toEqual</span><span style="color:#666666;">(</span><span style="color:#BD976A;">expect</span><span style="color:#666666;">.</span><span style="color:#80A665;">any</span><span style="color:#666666;">(</span><span style="color:#BD976A;">Cancel</span><span style="color:#666666;">))</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#BD976A;">reason</span><span style="color:#666666;">.</span><span style="color:#BD976A;">message</span><span style="color:#666666;">).</span><span style="color:#80A665;">toBe</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Operation has been canceled.</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#80A665;">done</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#80A665;">getAjaxRequest</span><span style="color:#666666;">().</span><span style="color:#80A665;">then</span><span style="color:#666666;">(</span><span style="color:#BD976A;">request</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">source</span><span style="color:#666666;">.</span><span style="color:#80A665;">cancel</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Operation has been canceled.</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#80A665;">setTimeout</span><span style="color:#666666;">(()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#BD976A;">request</span><span style="color:#666666;">.</span><span style="color:#80A665;">respondWith</span><span style="color:#666666;">({</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#B8A965;">status</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">200</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#B8A965;">responseText</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">OK</span><span style="color:#C98A7DAA;">&#39;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">},</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">100</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">test</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">calls abort on request object</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">done</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#CB7676;">const </span><span style="color:#BD976A;">source</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">CancelToken</span><span style="color:#666666;">.</span><span style="color:#80A665;">source</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#CB7676;">let </span><span style="color:#BD976A;">request</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">any</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#BD976A;">axios</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">.</span><span style="color:#80A665;">get</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">/foo/bar</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#B8A965;">cancelToken</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">source</span><span style="color:#666666;">.</span><span style="color:#BD976A;">token</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">.</span><span style="color:#80A665;">catch</span><span style="color:#666666;">(()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#80A665;">expect</span><span style="color:#666666;">(</span><span style="color:#BD976A;">request</span><span style="color:#666666;">.</span><span style="color:#BD976A;">statusText</span><span style="color:#666666;">).</span><span style="color:#80A665;">toBe</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">abort</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#80A665;">done</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#80A665;">getAjaxRequest</span><span style="color:#666666;">().</span><span style="color:#80A665;">then</span><span style="color:#666666;">(</span><span style="color:#BD976A;">req</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">source</span><span style="color:#666666;">.</span><span style="color:#80A665;">cancel</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">request</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">req</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">describe</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">when called after response has been received</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">test</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">should not cause unhandled rejection</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">done</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#CB7676;">const </span><span style="color:#BD976A;">source</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">CancelToken</span><span style="color:#666666;">.</span><span style="color:#80A665;">source</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#BD976A;">axios</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">.</span><span style="color:#80A665;">get</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">/foo</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#B8A965;">cancelToken</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">source</span><span style="color:#666666;">.</span><span style="color:#BD976A;">token</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">.</span><span style="color:#80A665;">then</span><span style="color:#666666;">(()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#BD976A;">window</span><span style="color:#666666;">.</span><span style="color:#80A665;">addEventListener</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">unhandledrejection</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">done</span><span style="color:#666666;">.</span><span style="color:#80A665;">fail</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Unhandled rejection.</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#BD976A;">source</span><span style="color:#666666;">.</span><span style="color:#80A665;">cancel</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#80A665;">setTimeout</span><span style="color:#666666;">(</span><span style="color:#BD976A;">done</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">100</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#80A665;">getAjaxRequest</span><span style="color:#666666;">().</span><span style="color:#80A665;">then</span><span style="color:#666666;">(</span><span style="color:#BD976A;">request</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">request</span><span style="color:#666666;">.</span><span style="color:#80A665;">respondWith</span><span style="color:#666666;">({</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#B8A965;">status</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">200</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#B8A965;">responseText</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">OK</span><span style="color:#C98A7DAA;">&#39;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#666666;">})</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">axios</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">../src/index</span><span style="color:#B56959AA;">&#39;</span></span>
<span class="line"><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">getAjaxRequest</span><span style="color:#393A34;"> </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">./helper</span><span style="color:#B56959AA;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;">describe</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">cancel</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">const </span><span style="color:#B07D48;">CancelToken</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">axios</span><span style="color:#999999;">.</span><span style="color:#B07D48;">CancelToken</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">const </span><span style="color:#B07D48;">Cancel</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">axios</span><span style="color:#999999;">.</span><span style="color:#B07D48;">Cancel</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">beforeEach</span><span style="color:#999999;">(()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">jasmine</span><span style="color:#999999;">.</span><span style="color:#B07D48;">Ajax</span><span style="color:#999999;">.</span><span style="color:#59873A;">install</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">afterEach</span><span style="color:#999999;">(()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">jasmine</span><span style="color:#999999;">.</span><span style="color:#B07D48;">Ajax</span><span style="color:#999999;">.</span><span style="color:#59873A;">uninstall</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">describe</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">when called before sending request</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">test</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">should rejects Promise with a Cancel object</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#AB5959;">const </span><span style="color:#B07D48;">source</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">CancelToken</span><span style="color:#999999;">.</span><span style="color:#59873A;">source</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#B07D48;">source</span><span style="color:#999999;">.</span><span style="color:#59873A;">cancel</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Operation has been canceled.</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">axios</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">.</span><span style="color:#59873A;">get</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">/foo</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#998418;">cancelToken</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">source</span><span style="color:#999999;">.</span><span style="color:#B07D48;">token</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">.</span><span style="color:#59873A;">catch</span><span style="color:#999999;">(</span><span style="color:#B07D48;">reason</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#B07D48;">reason</span><span style="color:#999999;">).</span><span style="color:#59873A;">toEqual</span><span style="color:#999999;">(</span><span style="color:#B07D48;">expect</span><span style="color:#999999;">.</span><span style="color:#59873A;">any</span><span style="color:#999999;">(</span><span style="color:#B07D48;">Cancel</span><span style="color:#999999;">))</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#B07D48;">reason</span><span style="color:#999999;">.</span><span style="color:#B07D48;">message</span><span style="color:#999999;">).</span><span style="color:#59873A;">toBe</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Operation has been canceled.</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">describe</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">when called after request has been sent</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">test</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">should rejects Promise with a Cancel object</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">done</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#AB5959;">const </span><span style="color:#B07D48;">source</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">CancelToken</span><span style="color:#999999;">.</span><span style="color:#59873A;">source</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#B07D48;">axios</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">.</span><span style="color:#59873A;">get</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">/foo/bar</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#998418;">cancelToken</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">source</span><span style="color:#999999;">.</span><span style="color:#B07D48;">token</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">.</span><span style="color:#59873A;">catch</span><span style="color:#999999;">(</span><span style="color:#B07D48;">reason</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#B07D48;">reason</span><span style="color:#999999;">).</span><span style="color:#59873A;">toEqual</span><span style="color:#999999;">(</span><span style="color:#B07D48;">expect</span><span style="color:#999999;">.</span><span style="color:#59873A;">any</span><span style="color:#999999;">(</span><span style="color:#B07D48;">Cancel</span><span style="color:#999999;">))</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#B07D48;">reason</span><span style="color:#999999;">.</span><span style="color:#B07D48;">message</span><span style="color:#999999;">).</span><span style="color:#59873A;">toBe</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Operation has been canceled.</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#59873A;">done</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#59873A;">getAjaxRequest</span><span style="color:#999999;">().</span><span style="color:#59873A;">then</span><span style="color:#999999;">(</span><span style="color:#B07D48;">request</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">source</span><span style="color:#999999;">.</span><span style="color:#59873A;">cancel</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Operation has been canceled.</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#59873A;">setTimeout</span><span style="color:#999999;">(()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#B07D48;">request</span><span style="color:#999999;">.</span><span style="color:#59873A;">respondWith</span><span style="color:#999999;">({</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#998418;">status</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">200</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#998418;">responseText</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">OK</span><span style="color:#B56959AA;">&#39;</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">},</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">100</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">test</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">calls abort on request object</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">done</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#AB5959;">const </span><span style="color:#B07D48;">source</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">CancelToken</span><span style="color:#999999;">.</span><span style="color:#59873A;">source</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#AB5959;">let </span><span style="color:#B07D48;">request</span><span style="color:#999999;">: </span><span style="color:#2E808F;">any</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#B07D48;">axios</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">.</span><span style="color:#59873A;">get</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">/foo/bar</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#998418;">cancelToken</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">source</span><span style="color:#999999;">.</span><span style="color:#B07D48;">token</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">.</span><span style="color:#59873A;">catch</span><span style="color:#999999;">(()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#59873A;">expect</span><span style="color:#999999;">(</span><span style="color:#B07D48;">request</span><span style="color:#999999;">.</span><span style="color:#B07D48;">statusText</span><span style="color:#999999;">).</span><span style="color:#59873A;">toBe</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">abort</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#59873A;">done</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#59873A;">getAjaxRequest</span><span style="color:#999999;">().</span><span style="color:#59873A;">then</span><span style="color:#999999;">(</span><span style="color:#B07D48;">req</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">source</span><span style="color:#999999;">.</span><span style="color:#59873A;">cancel</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">request</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">req</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">describe</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">when called after response has been received</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">test</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">should not cause unhandled rejection</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">done</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#AB5959;">const </span><span style="color:#B07D48;">source</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">CancelToken</span><span style="color:#999999;">.</span><span style="color:#59873A;">source</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#B07D48;">axios</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">.</span><span style="color:#59873A;">get</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">/foo</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#998418;">cancelToken</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">source</span><span style="color:#999999;">.</span><span style="color:#B07D48;">token</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">.</span><span style="color:#59873A;">then</span><span style="color:#999999;">(()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#B07D48;">window</span><span style="color:#999999;">.</span><span style="color:#59873A;">addEventListener</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">unhandledrejection</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">done</span><span style="color:#999999;">.</span><span style="color:#59873A;">fail</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Unhandled rejection.</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#B07D48;">source</span><span style="color:#999999;">.</span><span style="color:#59873A;">cancel</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#59873A;">setTimeout</span><span style="color:#999999;">(</span><span style="color:#B07D48;">done</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">100</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#59873A;">getAjaxRequest</span><span style="color:#999999;">().</span><span style="color:#59873A;">then</span><span style="color:#999999;">(</span><span style="color:#B07D48;">request</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">request</span><span style="color:#999999;">.</span><span style="color:#59873A;">respondWith</span><span style="color:#999999;">({</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#998418;">status</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">200</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#998418;">responseText</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">OK</span><span style="color:#B56959AA;">&#39;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#999999;">})</span></span>
<span class="line"></span></code></pre></div><p>\u6CE8\u610F\u8FD9\u91CC\u6211\u4EEC\u4F7F\u7528\u4E86 <code>done.fail</code> \u8868\u793A\u4E86\u4E00\u4E2A\u5F02\u5E38\u7684\u7ED3\u675F\uFF0C\u8FD9\u4E2A\u5E76\u672A\u5728 Jest \u6587\u6863\u4E2D\u4F53\u73B0\uFF0C\u4F46\u5B83\u662F\u4E00\u4E2A\u53EF\u4EE5\u7528\u7684 API\u3002</p><p>\u81F3\u6B64\uFF0C\u6211\u4EEC\u5B8C\u6210\u4E86\u53D6\u6D88\u6A21\u5757\u76F8\u5173\u4E1A\u52A1\u903B\u8F91\u7684\u5355\u5143\u6D4B\u8BD5\uFF0C\u6211\u4EEC\u6D4B\u8BD5\u8986\u76D6\u7387\u8FBE\u5230\u4E86\u9608\u503C\uFF0C\u6D4B\u8BD5\u5DF2\u7ECF\u901A\u8FC7\u4E86\u3002\u4F46\u662F\u6254\u672A\u8FBE\u5230\u6211\u4EEC\u7684\u76EE\u6807\uFF0C\u8FD8\u6709\u5F88\u591A feature \u662F\u6CA1\u6709\u8986\u76D6\u5230\u7684\u3002\u63A5\u4E0B\u6765\u6211\u4EEC\u5C31\u5B8C\u6210\u5269\u4F59 feature \u7684\u7F16\u5199\u5355\u5143\u6D4B\u8BD5\u3002</p>`,14),e=[o];function c(t,r,y,A,D,B){return a(),n("div",null,e)}const E=s(p,[["render",c]]);export{i as __pageData,E as default};
