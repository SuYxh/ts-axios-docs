<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>上传和下载的进度监控 | TS 从零实现 axios</title>
    <meta name="description" content="A VitePress site">
    <link rel="stylesheet" href="/ts-axios-docs/assets/style.28fe24ef.css">
    <link rel="modulepreload" href="/ts-axios-docs/assets/app.494a6664.js">
    <link rel="modulepreload" href="/ts-axios-docs/assets/guide_chapter10_upload-download.md.e60fc092.lean.js">
    
    <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-82528fa6><!--[--><!--]--><!--[--><span tabindex="-1" data-v-f637ee78></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-f637ee78> Skip to content </a><!--]--><!----><header class="VPNav" data-v-82528fa6 data-v-86afb924><div class="VPNavBar has-sidebar" data-v-86afb924 data-v-7a5a363d><div class="container" data-v-7a5a363d><div class="VPNavBarTitle has-sidebar" data-v-7a5a363d data-v-aaed7263><a class="title" href="/ts-axios-docs/" data-v-aaed7263><!--[--><!--]--><!--[--><img class="VPImage logo" src="/ts-axios-docs/typescript.png" alt data-v-ca1a0a93><!--]--><!--[-->TS 从零实现 axios<!--]--><!--[--><!--]--></a></div><div class="content" data-v-7a5a363d><!--[--><!--]--><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-7a5a363d data-v-d8cdd395><span id="main-nav-aria-label" class="visually-hidden" data-v-d8cdd395>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="https://github.com/SuYxh/ts-axios" target="_blank" rel="noreferrer" data-v-d8cdd395 data-v-08b6ef03 data-v-97a44ddd><!--[-->TS-Axios<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-7a5a363d data-v-d70ebc80><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-d70ebc80 data-v-9a8716a3 data-v-3258a739><span class="check" data-v-3258a739><span class="icon" data-v-3258a739><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-9a8716a3><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-9a8716a3><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-7a5a363d data-v-6a2a6555 data-v-b8f6762d><!--[--><a class="VPSocialLink" href="https://github.com/SuYxh/new-vitepress-demo" target="_blank" rel="noopener" data-v-b8f6762d data-v-179ad0ea><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink" href="https://juejin.cn/user/2084329779636094" target="_blank" rel="noopener" data-v-b8f6762d data-v-179ad0ea><svg t="1663660926462" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2449" width="200" height="200"><path d="M465.189 161.792c-22.967 18.14-44.325 35.109-47.397 37.742l-5.851 4.68 10.971 8.632c5.998 4.827 11.85 9.508 13.02 10.532 1.17 1.024 17.993 14.336 37.156 29.696l34.962 27.795 5.267-3.95c2.925-2.194 23.259-18.432 45.348-35.986 21.943-17.555 41.253-32.768 42.716-33.646 1.609-1.024 2.779-2.194 2.779-2.78 0-0.438-9.655-8.63-21.504-17.846-11.995-9.363-22.674-17.847-23.845-18.871-15.945-13.02-49.737-39.059-50.76-39.059-0.586 0.147-19.896 14.922-42.862 33.061z m233.325 180.37C507.465 493.275 508.928 492.105 505.417 489.911c-3.072-1.902-11.556-8.485-64.073-50.03-9.07-7.168-18.578-14.775-21.358-16.823-2.78-2.194-8.777-6.875-13.312-10.532-4.68-3.657-10.679-8.339-13.312-10.533-13.165-10.24-71.095-56.027-102.107-80.457-5.852-4.681-11.41-8.485-12.142-8.485-0.731 0-10.971 7.754-22.674 17.116-11.703 9.508-22.674 18.286-24.284 19.456-1.755 1.17-5.12 3.95-7.46 6.144-2.34 2.34-4.828 4.096-5.413 4.096-3.072 0-0.731 3.072 6.437 8.777 4.096 3.218 8.777 6.875 10.094 8.046 1.316 1.024 10.24 8.045 19.748 15.506s23.26 18.286 30.428 23.99c19.31 15.215 31.89 25.308 127.853 101.084 47.836 37.742 88.796 69.779 90.844 71.095 3.657 2.487 3.95 2.487 7.46-0.292a1041.42 1041.42 0 0 0 16.092-12.727c6.875-5.413 14.775-11.703 17.554-13.897 30.135-23.699 80.018-63.05 81.774-64.512 1.17-1.024 12.434-9.802 24.868-19.603s37.888-29.696 56.32-44.324c18.579-14.629 46.227-36.425 61.733-48.567 15.506-12.142 27.794-22.528 27.502-23.26-0.878-1.17-57.637-47.104-59.978-48.274-0.731-0.439-18.578 12.727-39.497 29.257z" fill="#8a8a8a" p-id="2450"></path><path d="M57.93 489.326c-15.215 12.288-28.527 23.405-29.697 24.576-2.34 2.194-5.412-0.44 80.018 66.852 33.207 26.185 32.622 25.747 57.637 45.495 10.386 8.192 36.279 28.672 57.783 45.495 38.18 30.135 44.91 35.401 52.663 41.545 2.048 1.756 22.967 18.14 46.372 36.572 23.26 18.432 74.167 58.514 112.933 89.088 38.912 30.573 71.095 55.734 71.826 56.027 0.732 0.293 7.46-4.389 14.921-10.386 21.797-16.97 90.259-70.949 101.523-79.872 5.705-4.535 12.873-10.24 15.945-12.58 3.072-2.488 6.436-5.12 7.314-5.852 0.878-0.878 11.85-9.509 24.283-19.31 20.773-16.091 59.1-46.226 64.366-50.615 1.17-1.024 5.12-4.096 8.777-6.875 3.657-2.78 7.9-6.29 9.509-7.607 1.609-1.317 14.775-11.703 29.257-23.113 29.11-22.82 42.277-33.207 88.503-69.632 17.262-13.605 32.475-25.454 33.646-26.478 2.486-2.048 31.451-24.869 44.617-35.255 4.827-3.657 9.07-7.168 9.508-7.607 0.44-0.585 5.998-4.827 12.435-9.8 6.436-4.828 13.165-10.24 15.067-11.85l3.365-2.926-9.948-7.753c-5.412-4.388-10.24-8.192-10.679-8.63-1.17-1.317-22.381-18.433-30.135-24.284-3.95-3.072-7.314-5.998-7.606-6.73-1.317-3.071-6.73 0.147-29.258 17.994-13.458 10.532-25.746 20.187-27.355 21.504-1.61 1.463-10.533 8.338-19.749 15.652-9.216 7.168-17.115 13.459-17.554 13.898-0.439 0.438-6.583 5.412-13.897 10.971-7.168 5.559-15.214 11.703-17.7 13.75-4.974 4.097-5.413 4.39-20.334 16.239-5.56 4.388-11.264 8.777-12.435 9.8-1.17 1.025-20.333 16.092-42.422 33.354-22.09 17.408-41.546 32.768-43.155 34.084-1.609 1.463-14.482 11.557-28.525 22.528s-40.814 32.037-59.539 46.812c-18.578 14.775-42.276 33.353-52.516 41.399s-23.26 18.285-28.965 22.82l-10.386 8.339-4.389-3.072c-2.34-1.756-4.68-3.511-5.12-3.95-0.439-0.439-4.973-4.096-10.24-8.046-11.849-9.216-14.482-11.264-16.676-13.166-0.878-0.877-4.243-3.51-7.46-5.851-3.22-2.487-6.145-4.681-6.584-5.12-0.439-0.439-6.875-5.705-14.482-11.703-7.607-5.851-14.921-11.556-16.091-12.58-1.317-1.17-17.116-13.605-35.255-27.795-17.993-14.19-35.109-27.648-38.035-29.842-5.705-4.681-33.499-26.624-125.074-98.743-34.523-27.209-72.704-57.344-84.846-66.852-49.737-39.498-55.15-43.594-56.905-43.447-0.877 0-14.043 10.24-29.257 22.528z" fill="#8a8a8a" p-id="2451"></path></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-7a5a363d data-v-b390db70 data-v-aeb1c475><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-aeb1c475><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-aeb1c475><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-aeb1c475><div class="VPMenu" data-v-aeb1c475 data-v-079aa243><!----><!--[--><!--[--><!----><div class="group" data-v-b390db70><div class="item appearance" data-v-b390db70><p class="label" data-v-b390db70>Appearance</p><div class="appearance-action" data-v-b390db70><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-b390db70 data-v-9a8716a3 data-v-3258a739><span class="check" data-v-3258a739><span class="icon" data-v-3258a739><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-9a8716a3><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-9a8716a3><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-b390db70><div class="item social-links" data-v-b390db70><div class="VPSocialLinks social-links-list" data-v-b390db70 data-v-b8f6762d><!--[--><a class="VPSocialLink" href="https://github.com/SuYxh/new-vitepress-demo" target="_blank" rel="noopener" data-v-b8f6762d data-v-179ad0ea><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink" href="https://juejin.cn/user/2084329779636094" target="_blank" rel="noopener" data-v-b8f6762d data-v-179ad0ea><svg t="1663660926462" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2449" width="200" height="200"><path d="M465.189 161.792c-22.967 18.14-44.325 35.109-47.397 37.742l-5.851 4.68 10.971 8.632c5.998 4.827 11.85 9.508 13.02 10.532 1.17 1.024 17.993 14.336 37.156 29.696l34.962 27.795 5.267-3.95c2.925-2.194 23.259-18.432 45.348-35.986 21.943-17.555 41.253-32.768 42.716-33.646 1.609-1.024 2.779-2.194 2.779-2.78 0-0.438-9.655-8.63-21.504-17.846-11.995-9.363-22.674-17.847-23.845-18.871-15.945-13.02-49.737-39.059-50.76-39.059-0.586 0.147-19.896 14.922-42.862 33.061z m233.325 180.37C507.465 493.275 508.928 492.105 505.417 489.911c-3.072-1.902-11.556-8.485-64.073-50.03-9.07-7.168-18.578-14.775-21.358-16.823-2.78-2.194-8.777-6.875-13.312-10.532-4.68-3.657-10.679-8.339-13.312-10.533-13.165-10.24-71.095-56.027-102.107-80.457-5.852-4.681-11.41-8.485-12.142-8.485-0.731 0-10.971 7.754-22.674 17.116-11.703 9.508-22.674 18.286-24.284 19.456-1.755 1.17-5.12 3.95-7.46 6.144-2.34 2.34-4.828 4.096-5.413 4.096-3.072 0-0.731 3.072 6.437 8.777 4.096 3.218 8.777 6.875 10.094 8.046 1.316 1.024 10.24 8.045 19.748 15.506s23.26 18.286 30.428 23.99c19.31 15.215 31.89 25.308 127.853 101.084 47.836 37.742 88.796 69.779 90.844 71.095 3.657 2.487 3.95 2.487 7.46-0.292a1041.42 1041.42 0 0 0 16.092-12.727c6.875-5.413 14.775-11.703 17.554-13.897 30.135-23.699 80.018-63.05 81.774-64.512 1.17-1.024 12.434-9.802 24.868-19.603s37.888-29.696 56.32-44.324c18.579-14.629 46.227-36.425 61.733-48.567 15.506-12.142 27.794-22.528 27.502-23.26-0.878-1.17-57.637-47.104-59.978-48.274-0.731-0.439-18.578 12.727-39.497 29.257z" fill="#8a8a8a" p-id="2450"></path><path d="M57.93 489.326c-15.215 12.288-28.527 23.405-29.697 24.576-2.34 2.194-5.412-0.44 80.018 66.852 33.207 26.185 32.622 25.747 57.637 45.495 10.386 8.192 36.279 28.672 57.783 45.495 38.18 30.135 44.91 35.401 52.663 41.545 2.048 1.756 22.967 18.14 46.372 36.572 23.26 18.432 74.167 58.514 112.933 89.088 38.912 30.573 71.095 55.734 71.826 56.027 0.732 0.293 7.46-4.389 14.921-10.386 21.797-16.97 90.259-70.949 101.523-79.872 5.705-4.535 12.873-10.24 15.945-12.58 3.072-2.488 6.436-5.12 7.314-5.852 0.878-0.878 11.85-9.509 24.283-19.31 20.773-16.091 59.1-46.226 64.366-50.615 1.17-1.024 5.12-4.096 8.777-6.875 3.657-2.78 7.9-6.29 9.509-7.607 1.609-1.317 14.775-11.703 29.257-23.113 29.11-22.82 42.277-33.207 88.503-69.632 17.262-13.605 32.475-25.454 33.646-26.478 2.486-2.048 31.451-24.869 44.617-35.255 4.827-3.657 9.07-7.168 9.508-7.607 0.44-0.585 5.998-4.827 12.435-9.8 6.436-4.828 13.165-10.24 15.067-11.85l3.365-2.926-9.948-7.753c-5.412-4.388-10.24-8.192-10.679-8.63-1.17-1.317-22.381-18.433-30.135-24.284-3.95-3.072-7.314-5.998-7.606-6.73-1.317-3.071-6.73 0.147-29.258 17.994-13.458 10.532-25.746 20.187-27.355 21.504-1.61 1.463-10.533 8.338-19.749 15.652-9.216 7.168-17.115 13.459-17.554 13.898-0.439 0.438-6.583 5.412-13.897 10.971-7.168 5.559-15.214 11.703-17.7 13.75-4.974 4.097-5.413 4.39-20.334 16.239-5.56 4.388-11.264 8.777-12.435 9.8-1.17 1.025-20.333 16.092-42.422 33.354-22.09 17.408-41.546 32.768-43.155 34.084-1.609 1.463-14.482 11.557-28.525 22.528s-40.814 32.037-59.539 46.812c-18.578 14.775-42.276 33.353-52.516 41.399s-23.26 18.285-28.965 22.82l-10.386 8.339-4.389-3.072c-2.34-1.756-4.68-3.511-5.12-3.95-0.439-0.439-4.973-4.096-10.24-8.046-11.849-9.216-14.482-11.264-16.676-13.166-0.878-0.877-4.243-3.51-7.46-5.851-3.22-2.487-6.145-4.681-6.584-5.12-0.439-0.439-6.875-5.705-14.482-11.703-7.607-5.851-14.921-11.556-16.091-12.58-1.317-1.17-17.116-13.605-35.255-27.795-17.993-14.19-35.109-27.648-38.035-29.842-5.705-4.681-33.499-26.624-125.074-98.743-34.523-27.209-72.704-57.344-84.846-66.852-49.737-39.498-55.15-43.594-56.905-43.447-0.877 0-14.043 10.24-29.257 22.528z" fill="#8a8a8a" p-id="2451"></path></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-7a5a363d data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div><!----></header><div class="VPLocalNav" data-v-82528fa6 data-v-72f15439><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-72f15439><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-72f15439><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-72f15439>Menu</span></button><a class="top-link" href="#" data-v-72f15439> Return to top </a></div><aside class="VPSidebar" data-v-82528fa6 data-v-240a42a7><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-240a42a7><span class="visually-hidden" id="sidebar-aria-label" data-v-240a42a7> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-240a42a7><section class="VPSidebarGroup" data-v-240a42a7 data-v-a094e895><div class="title" data-v-a094e895><h2 class="title-text" data-v-a094e895>初识 TypeScript</h2><div class="action" data-v-a094e895><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-a094e895><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-a094e895><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-a094e895><!--[--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter1/README.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>简介</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter1/install.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>安装 TypeScript</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter1/start.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>编写第一个 TypeScript 程序</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-240a42a7><section class="VPSidebarGroup" data-v-240a42a7 data-v-a094e895><div class="title" data-v-a094e895><h2 class="title-text" data-v-a094e895>TypeScript 常用语法</h2><div class="action" data-v-a094e895><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-a094e895><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-a094e895><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-a094e895><!--[--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter2/type.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>基础类型</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter2/declare.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>变量声明</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter2/interface.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>接口</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter2/class.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>类</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter2/function.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>函数</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter2/generic.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>泛型</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter2/inference.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>类型推断</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter2/advance.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>高级类型</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-240a42a7><section class="VPSidebarGroup" data-v-240a42a7 data-v-a094e895><div class="title" data-v-a094e895><h2 class="title-text" data-v-a094e895>ts-axios 项目初始化</h2><div class="action" data-v-a094e895><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-a094e895><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-a094e895><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-a094e895><!--[--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter3/require.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>需求分析</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter3/init.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>初始化项目</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter3/base.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>编写基础请求代码</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-240a42a7><section class="VPSidebarGroup" data-v-240a42a7 data-v-a094e895><div class="title" data-v-a094e895><h2 class="title-text" data-v-a094e895>ts-axios 基础功能实现</h2><div class="action" data-v-a094e895><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-a094e895><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-a094e895><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-a094e895><!--[--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter4/url.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>处理请求 url 参数</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter4/data.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>处理请求 body 数据</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter4/header.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>处理请求 header</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter4/response.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>获取响应数据</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter4/response-header.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>处理响应 header</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter4/response-data.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>处理响应 data</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-240a42a7><section class="VPSidebarGroup" data-v-240a42a7 data-v-a094e895><div class="title" data-v-a094e895><h2 class="title-text" data-v-a094e895>ts-axios 异常情况处理</h2><div class="action" data-v-a094e895><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-a094e895><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-a094e895><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-a094e895><!--[--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter5/error.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>错误处理</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter5/enhance.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>错误信息增强</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-240a42a7><section class="VPSidebarGroup" data-v-240a42a7 data-v-a094e895><div class="title" data-v-a094e895><h2 class="title-text" data-v-a094e895>ts-axios 接口扩展</h2><div class="action" data-v-a094e895><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-a094e895><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-a094e895><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-a094e895><!--[--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter6/extend.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>扩展接口</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter6/overload.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>axios 函数重载</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter6/generic.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>响应数据支持泛型</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-240a42a7><section class="VPSidebarGroup" data-v-240a42a7 data-v-a094e895><div class="title" data-v-a094e895><h2 class="title-text" data-v-a094e895>ts-axios 拦截器实现</h2><div class="action" data-v-a094e895><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-a094e895><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-a094e895><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-a094e895><!--[--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter7/interceptor.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>拦截器设计与实现</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-240a42a7><section class="VPSidebarGroup" data-v-240a42a7 data-v-a094e895><div class="title" data-v-a094e895><h2 class="title-text" data-v-a094e895>ts-axios 配置化实现</h2><div class="action" data-v-a094e895><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-a094e895><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-a094e895><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-a094e895><!--[--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter8/merge.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>合并配置的设计与实现</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter8/transform.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>请求和响应配置化</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter8/create.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>扩展 axios.create 静态接口</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-240a42a7><section class="VPSidebarGroup" data-v-240a42a7 data-v-a094e895><div class="title" data-v-a094e895><h2 class="title-text" data-v-a094e895>ts-axios 取消功能实现</h2><div class="action" data-v-a094e895><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-a094e895><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-a094e895><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-a094e895><!--[--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter9/cancel.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>取消功能的设计与实现</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-240a42a7><section class="VPSidebarGroup" data-v-240a42a7 data-v-a094e895><div class="title" data-v-a094e895><h2 class="title-text" data-v-a094e895>ts-axios 更多功能实现</h2><div class="action" data-v-a094e895><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-a094e895><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-a094e895><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-a094e895><!--[--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter10/withCredentials.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>withCredentials</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter10/xsrf.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>XSRF 防御</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link active" href="/ts-axios-docs/guide/chapter10/upload-download.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>上传和下载的进度监控</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter10/auth.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>HTTP 授权</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter10/validateStatus.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>自定义合法状态码</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter10/paramsSerializer.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>自定义参数序列化</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter10/baseURL.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>baseURL</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter10/static.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>静态方法扩展</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><div class="group" data-v-240a42a7><section class="VPSidebarGroup" data-v-240a42a7 data-v-a094e895><div class="title" data-v-a094e895><h2 class="title-text" data-v-a094e895>ts-axios 单元测试</h2><div class="action" data-v-a094e895><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-a094e895><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-a094e895><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-a094e895><!--[--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter11/preface.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>前言</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter11/jest.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>Jest 安装和配置</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter11/helpers.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>辅助模块单元测试</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter11/requests.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>请求模块单元测试</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter11/headers.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>headers 模块单元测试</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter11/instance.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>Axios 实例模块单元测试</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter11/interceptor.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>拦截器模块单元测试</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter11/mergeConfig.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>mergeConfig 模块单元测试</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter11/cancel.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>请求取消模块单元测试</span><!--]--><!----></a><!----><!--]--><!--[--><a class="VPLink link link" href="/ts-axios-docs/guide/chapter11/more.html" style="padding-left:0px;" data-v-63c070bf data-v-97a44ddd><!--[--><span class="link-text" data-v-63c070bf>剩余模块单元测试</span><!--]--><!----></a><!----><!--]--><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-82528fa6 data-v-b2b5ab3c><div class="VPDoc has-sidebar has-aside" data-v-b2b5ab3c data-v-6b6fcb79><div class="container" data-v-6b6fcb79><div class="aside" data-v-6b6fcb79><div class="aside-curtain" data-v-6b6fcb79></div><div class="aside-container" data-v-6b6fcb79><div class="aside-content" data-v-6b6fcb79><div class="VPDocAside" data-v-6b6fcb79 data-v-c8158c08><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-c8158c08 data-v-1c535019><div class="content" data-v-1c535019><div class="outline-marker" data-v-1c535019></div><div class="outline-title" data-v-1c535019>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-1c535019><span class="visually-hidden" id="doc-outline-aria-label" data-v-1c535019> Table of Contents for current page </span><ul class="root" data-v-1c535019 data-v-f1f7b818><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-c8158c08></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-6b6fcb79><div class="content-container" data-v-6b6fcb79><!--[--><!--]--><main class="main" data-v-6b6fcb79><div style="position:relative;" class="vp-doc _ts-axios-docs_guide_chapter10_upload-download" data-v-6b6fcb79><div><h1 id="上传和下载的进度监控" tabindex="-1">上传和下载的进度监控 <a class="header-anchor" href="#上传和下载的进度监控" aria-hidden="true">#</a></h1><h2 id="需求分析" tabindex="-1">需求分析 <a class="header-anchor" href="#需求分析" aria-hidden="true">#</a></h2><p>有些时候，当我们上传文件或者是请求一个大体积数据的时候，希望知道实时的进度，甚至可以基于此做一个进度条的展示。</p><p>我们希望给 <code>axios</code> 的请求配置提供 <code>onDownloadProgress</code> 和 <code>onUploadProgress</code> 2 个函数属性，用户可以通过这俩函数实现对下载进度和上传进度的监控。</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#BD976A;">axios</span><span style="color:#666666;">.</span><span style="color:#80A665;">get</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">/more/get</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">onDownloadProgress</span><span style="color:#666666;">(</span><span style="color:#BD976A;">progressEvent</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// 监听下载进度</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">axios</span><span style="color:#666666;">.</span><span style="color:#80A665;">post</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">/more/post</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">onUploadProgress</span><span style="color:#666666;">(</span><span style="color:#BD976A;">progressEvent</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// 监听上传进度</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">})</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#B07D48;">axios</span><span style="color:#999999;">.</span><span style="color:#59873A;">get</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">/more/get</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">onDownloadProgress</span><span style="color:#999999;">(</span><span style="color:#B07D48;">progressEvent</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// 监听下载进度</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">axios</span><span style="color:#999999;">.</span><span style="color:#59873A;">post</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">/more/post</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">onUploadProgress</span><span style="color:#999999;">(</span><span style="color:#B07D48;">progressEvent</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// 监听上传进度</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">})</span></span>
<span class="line"></span></code></pre></div><p><code>xhr</code> 对象提供了一个 <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/progress_event" target="_blank" rel="noreferrer"><code>progress</code></a> 事件，我们可以监听此事件对数据的下载进度做监控；另外，<a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/upload" target="_blank" rel="noreferrer"><code>xhr.uplaod</code></a> 对象也提供了 <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/progress_event" target="_blank" rel="noreferrer"><code>progress</code></a> 事件，我们可以基于此对上传进度做监控。</p><h2 id="代码实现" tabindex="-1">代码实现 <a class="header-anchor" href="#代码实现" aria-hidden="true">#</a></h2><p>首先修改一下类型定义。</p><p><code>types/index.ts</code>：</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">interface</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">AxiosRequestConfig</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">  </span><span style="color:#758575DD;">// ...</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">onDownloadProgress</span><span style="color:#CB7676;">?</span><span style="color:#666666;">: (</span><span style="color:#BD976A;">e</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">ProgressEvent</span><span style="color:#666666;">) =&gt; </span><span style="color:#5DA9A7;">void</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">onUploadProgress</span><span style="color:#CB7676;">?</span><span style="color:#666666;">: (</span><span style="color:#BD976A;">e</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">ProgressEvent</span><span style="color:#666666;">) =&gt; </span><span style="color:#5DA9A7;">void</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">interface</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">AxiosRequestConfig</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">  </span><span style="color:#A0ADA0;">// ...</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">onDownloadProgress</span><span style="color:#AB5959;">?</span><span style="color:#999999;">: (</span><span style="color:#B07D48;">e</span><span style="color:#999999;">: </span><span style="color:#2E808F;">ProgressEvent</span><span style="color:#999999;">) =&gt; </span><span style="color:#2E808F;">void</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">onUploadProgress</span><span style="color:#AB5959;">?</span><span style="color:#999999;">: (</span><span style="color:#B07D48;">e</span><span style="color:#999999;">: </span><span style="color:#2E808F;">ProgressEvent</span><span style="color:#999999;">) =&gt; </span><span style="color:#2E808F;">void</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><p>接着在发送请求前，给 <code>xhr</code> 对象添加属性。</p><p><code>core/xhr.ts</code>：</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#CB7676;">const </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#CB7676;">  </span><span style="color:#758575DD;">/*...*/</span></span>
<span class="line"><span style="color:#CB7676;">  </span><span style="color:#BD976A;">onDownloadProgress</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#CB7676;">  </span><span style="color:#BD976A;">onUploadProgress</span></span>
<span class="line"><span style="color:#666666;">}</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">config</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">onDownloadProgress</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">request</span><span style="color:#666666;">.</span><span style="color:#BD976A;">onprogress</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">onDownloadProgress</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">onUploadProgress</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">request</span><span style="color:#666666;">.</span><span style="color:#BD976A;">upload</span><span style="color:#666666;">.</span><span style="color:#BD976A;">onprogress</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">onUploadProgress</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#AB5959;">const </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#AB5959;">  </span><span style="color:#A0ADA0;">/*...*/</span></span>
<span class="line"><span style="color:#AB5959;">  </span><span style="color:#B07D48;">onDownloadProgress</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#AB5959;">  </span><span style="color:#B07D48;">onUploadProgress</span></span>
<span class="line"><span style="color:#999999;">}</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">config</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">onDownloadProgress</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">request</span><span style="color:#999999;">.</span><span style="color:#B07D48;">onprogress</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">onDownloadProgress</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">onUploadProgress</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">request</span><span style="color:#999999;">.</span><span style="color:#B07D48;">upload</span><span style="color:#999999;">.</span><span style="color:#B07D48;">onprogress</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">onUploadProgress</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><p>另外，如果请求的数据是 <code>FormData</code> 类型，我们应该主动删除请求 <code>headers</code> 中的 <code>Content-Type</code> 字段，让浏览器自动根据请求数据设置 <code>Content-Type</code>。比如当我们通过 <code>FormData</code> 上传文件的时候，浏览器会把请求 <code>headers</code> 中的 <code>Content-Type</code> 设置为 <code>multipart/form-data</code>。</p><p>我们先添加一个判断 <code>FormData</code> 的方法。</p><p><code>helpers/util.ts</code>：</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">isFormData</span><span style="color:#666666;">(</span><span style="color:#BD976A;">val</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">any</span><span style="color:#666666;">):</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">boolean</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">typeof</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">val</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">undefined</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;&amp;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">val</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">instanceof</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">FormData</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">isFormData</span><span style="color:#999999;">(</span><span style="color:#B07D48;">val</span><span style="color:#999999;">: </span><span style="color:#2E808F;">any</span><span style="color:#999999;">):</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">boolean</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">typeof</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">val</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">undefined</span><span style="color:#B56959AA;">&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;&amp;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">val</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">instanceof</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">FormData</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><p>然后再添加相关逻辑。</p><p><code>core/xhr.ts</code>：</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#80A665;">isFormData</span><span style="color:#666666;">(</span><span style="color:#BD976A;">data</span><span style="color:#666666;">))</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#CB7676;">delete</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">headers</span><span style="color:#666666;">[</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Content-Type</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">]</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#59873A;">isFormData</span><span style="color:#999999;">(</span><span style="color:#B07D48;">data</span><span style="color:#999999;">))</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">delete</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">headers</span><span style="color:#999999;">[</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Content-Type</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">]</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><p>我们发现，<code>xhr</code> 函数内部随着需求越来越多，代码也越来越臃肿，我们可以把逻辑梳理一下，把内部代码做一层封装优化。</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">default</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">xhr</span><span style="color:#666666;">(</span><span style="color:#BD976A;">config</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">AxiosRequestConfig</span><span style="color:#666666;">):</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">AxiosPromise</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">new</span><span style="color:#DBD7CAEE;"> </span><span style="color:#B8A965;">Promise</span><span style="color:#666666;">((</span><span style="color:#BD976A;">resolve</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">reject</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#CB7676;">      </span><span style="color:#BD976A;">data</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> null</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#CB7676;">      </span><span style="color:#BD976A;">url</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#CB7676;">      </span><span style="color:#BD976A;">method</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">get</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#CB7676;">      </span><span style="color:#BD976A;">headers</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#CB7676;">      </span><span style="color:#BD976A;">responseType</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#CB7676;">      </span><span style="color:#BD976A;">timeout</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#CB7676;">      </span><span style="color:#BD976A;">cancelToken</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#CB7676;">      </span><span style="color:#BD976A;">withCredentials</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#CB7676;">      </span><span style="color:#BD976A;">xsrfCookieName</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#CB7676;">      </span><span style="color:#BD976A;">xsrfHeaderName</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#CB7676;">      </span><span style="color:#BD976A;">onDownloadProgress</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#CB7676;">      </span><span style="color:#BD976A;">onUploadProgress</span></span>
<span class="line"><span style="color:#CB7676;">    </span><span style="color:#666666;">}</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">config</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const </span><span style="color:#BD976A;">request</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> new </span><span style="color:#80A665;">XMLHttpRequest</span><span style="color:#666666;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">request</span><span style="color:#666666;">.</span><span style="color:#80A665;">open</span><span style="color:#666666;">(</span><span style="color:#BD976A;">method</span><span style="color:#666666;">.</span><span style="color:#80A665;">toUpperCase</span><span style="color:#666666;">(),</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">url</span><span style="color:#CB7676;">!</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">configureRequest</span><span style="color:#666666;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">addEvents</span><span style="color:#666666;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">processHeaders</span><span style="color:#666666;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">processCancel</span><span style="color:#666666;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">request</span><span style="color:#666666;">.</span><span style="color:#80A665;">send</span><span style="color:#666666;">(</span><span style="color:#BD976A;">data</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">configureRequest</span><span style="color:#666666;">():</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">void</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">responseType</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">request</span><span style="color:#666666;">.</span><span style="color:#BD976A;">responseType</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">responseType</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">timeout</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">request</span><span style="color:#666666;">.</span><span style="color:#BD976A;">timeout</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">timeout</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">withCredentials</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">request</span><span style="color:#666666;">.</span><span style="color:#BD976A;">withCredentials</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">withCredentials</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">addEvents</span><span style="color:#666666;">():</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">void</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#BD976A;">request</span><span style="color:#666666;">.</span><span style="color:#80A665;">onreadystatechange</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">handleLoad</span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">request</span><span style="color:#666666;">.</span><span style="color:#BD976A;">readyState</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">4</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#4D9375;">return</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">request</span><span style="color:#666666;">.</span><span style="color:#BD976A;">status</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#4D9375;">return</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#CB7676;">const </span><span style="color:#BD976A;">responseHeaders</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#80A665;">parseHeaders</span><span style="color:#666666;">(</span><span style="color:#BD976A;">request</span><span style="color:#666666;">.</span><span style="color:#80A665;">getAllResponseHeaders</span><span style="color:#666666;">())</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#CB7676;">const </span><span style="color:#BD976A;">responseData</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span></span>
<span class="line"><span style="color:#CB7676;">          </span><span style="color:#BD976A;">responseType</span><span style="color:#CB7676;"> &amp;&amp; </span><span style="color:#BD976A;">responseType</span><span style="color:#CB7676;"> !== </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">text</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#CB7676;"> ? </span><span style="color:#BD976A;">request</span><span style="color:#666666;">.</span><span style="color:#BD976A;">response</span><span style="color:#CB7676;"> : </span><span style="color:#BD976A;">request</span><span style="color:#666666;">.</span><span style="color:#BD976A;">responseText</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#CB7676;">const </span><span style="color:#BD976A;">response</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">AxiosResponse</span><span style="color:#666666;"> =</span><span style="color:#CB7676;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#CB7676;">          </span><span style="color:#B8A965;">data</span><span style="color:#666666;">:</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">responseData</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#CB7676;">          </span><span style="color:#B8A965;">status</span><span style="color:#666666;">:</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">request</span><span style="color:#666666;">.</span><span style="color:#BD976A;">status</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#CB7676;">          </span><span style="color:#B8A965;">statusText</span><span style="color:#666666;">:</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">request</span><span style="color:#666666;">.</span><span style="color:#BD976A;">statusText</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#CB7676;">          </span><span style="color:#B8A965;">headers</span><span style="color:#666666;">:</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">responseHeaders</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#CB7676;">          </span><span style="color:#BD976A;">config</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#CB7676;">          </span><span style="color:#BD976A;">request</span></span>
<span class="line"><span style="color:#CB7676;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#80A665;">handleResponse</span><span style="color:#666666;">(</span><span style="color:#BD976A;">response</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#BD976A;">request</span><span style="color:#666666;">.</span><span style="color:#80A665;">onerror</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">handleError</span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#80A665;">reject</span><span style="color:#666666;">(</span><span style="color:#80A665;">createError</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Network Error</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">config</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">request</span><span style="color:#666666;">))</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#BD976A;">request</span><span style="color:#666666;">.</span><span style="color:#80A665;">ontimeout</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">handleTimeout</span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#80A665;">reject</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#80A665;">createError</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">`</span><span style="color:#C98A7D;">Timeout of </span><span style="color:#666666;">${</span><span style="color:#C98A7D;">config</span><span style="color:#666666;">.</span><span style="color:#C98A7D;">timeout</span><span style="color:#666666;">}</span><span style="color:#C98A7D;"> ms exceeded</span><span style="color:#C98A7DAA;">`</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">config</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">ECONNABORTED</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">request</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">onDownloadProgress</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">request</span><span style="color:#666666;">.</span><span style="color:#BD976A;">onprogress</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">onDownloadProgress</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">onUploadProgress</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">request</span><span style="color:#666666;">.</span><span style="color:#BD976A;">upload</span><span style="color:#666666;">.</span><span style="color:#BD976A;">onprogress</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">onUploadProgress</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">processHeaders</span><span style="color:#666666;">():</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">void</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#80A665;">isFormData</span><span style="color:#666666;">(</span><span style="color:#BD976A;">data</span><span style="color:#666666;">))</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#CB7676;">delete</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">headers</span><span style="color:#666666;">[</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Content-Type</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">]</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">((</span><span style="color:#BD976A;">withCredentials</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">||</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">isURLSameOrigin</span><span style="color:#666666;">(</span><span style="color:#BD976A;">url</span><span style="color:#CB7676;">!</span><span style="color:#666666;">))</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;&amp;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">xsrfCookieName</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#CB7676;">const </span><span style="color:#BD976A;">xsrfValue</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">cookie</span><span style="color:#666666;">.</span><span style="color:#80A665;">read</span><span style="color:#666666;">(</span><span style="color:#BD976A;">xsrfCookieName</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">xsrfValue</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#BD976A;">headers</span><span style="color:#666666;">[</span><span style="color:#BD976A;">xsrfHeaderName</span><span style="color:#CB7676;">!</span><span style="color:#666666;">]</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">xsrfValue</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#BD976A;">Object</span><span style="color:#666666;">.</span><span style="color:#80A665;">keys</span><span style="color:#666666;">(</span><span style="color:#BD976A;">headers</span><span style="color:#666666;">).</span><span style="color:#80A665;">forEach</span><span style="color:#666666;">(</span><span style="color:#BD976A;">name</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">data</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;&amp;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">name</span><span style="color:#666666;">.</span><span style="color:#80A665;">toLowerCase</span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">content-type</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#CB7676;">delete</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">headers</span><span style="color:#666666;">[</span><span style="color:#BD976A;">name</span><span style="color:#666666;">]</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">else</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#BD976A;">request</span><span style="color:#666666;">.</span><span style="color:#80A665;">setRequestHeader</span><span style="color:#666666;">(</span><span style="color:#BD976A;">name</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">headers</span><span style="color:#666666;">[</span><span style="color:#BD976A;">name</span><span style="color:#666666;">])</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">processCancel</span><span style="color:#666666;">():</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">void</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">cancelToken</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">cancelToken</span><span style="color:#666666;">.</span><span style="color:#BD976A;">promise</span><span style="color:#666666;">.</span><span style="color:#80A665;">then</span><span style="color:#666666;">(</span><span style="color:#BD976A;">reason</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#BD976A;">request</span><span style="color:#666666;">.</span><span style="color:#80A665;">abort</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#80A665;">reject</span><span style="color:#666666;">(</span><span style="color:#BD976A;">reason</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">handleResponse</span><span style="color:#666666;">(</span><span style="color:#BD976A;">response</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">AxiosResponse</span><span style="color:#666666;">):</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">void</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">response</span><span style="color:#666666;">.</span><span style="color:#BD976A;">status</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&gt;=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">200</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;&amp;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">response</span><span style="color:#666666;">.</span><span style="color:#BD976A;">status</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">300</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#80A665;">resolve</span><span style="color:#666666;">(</span><span style="color:#BD976A;">response</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">else</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#80A665;">reject</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#80A665;">createError</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#C98A7DAA;">`</span><span style="color:#C98A7D;">Request failed with status code </span><span style="color:#666666;">${</span><span style="color:#C98A7D;">response</span><span style="color:#666666;">.</span><span style="color:#C98A7D;">status</span><span style="color:#666666;">}</span><span style="color:#C98A7DAA;">`</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">config</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">request</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">response</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">default</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">xhr</span><span style="color:#999999;">(</span><span style="color:#B07D48;">config</span><span style="color:#999999;">: </span><span style="color:#2E808F;">AxiosRequestConfig</span><span style="color:#999999;">):</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">AxiosPromise</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">new</span><span style="color:#393A34;"> </span><span style="color:#998418;">Promise</span><span style="color:#999999;">((</span><span style="color:#B07D48;">resolve</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">reject</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#AB5959;">      </span><span style="color:#B07D48;">data</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> null</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#AB5959;">      </span><span style="color:#B07D48;">url</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#AB5959;">      </span><span style="color:#B07D48;">method</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">get</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#AB5959;">      </span><span style="color:#B07D48;">headers</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#AB5959;">      </span><span style="color:#B07D48;">responseType</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#AB5959;">      </span><span style="color:#B07D48;">timeout</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#AB5959;">      </span><span style="color:#B07D48;">cancelToken</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#AB5959;">      </span><span style="color:#B07D48;">withCredentials</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#AB5959;">      </span><span style="color:#B07D48;">xsrfCookieName</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#AB5959;">      </span><span style="color:#B07D48;">xsrfHeaderName</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#AB5959;">      </span><span style="color:#B07D48;">onDownloadProgress</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#AB5959;">      </span><span style="color:#B07D48;">onUploadProgress</span></span>
<span class="line"><span style="color:#AB5959;">    </span><span style="color:#999999;">}</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">config</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const </span><span style="color:#B07D48;">request</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> new </span><span style="color:#59873A;">XMLHttpRequest</span><span style="color:#999999;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">request</span><span style="color:#999999;">.</span><span style="color:#59873A;">open</span><span style="color:#999999;">(</span><span style="color:#B07D48;">method</span><span style="color:#999999;">.</span><span style="color:#59873A;">toUpperCase</span><span style="color:#999999;">(),</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">url</span><span style="color:#AB5959;">!</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">configureRequest</span><span style="color:#999999;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">addEvents</span><span style="color:#999999;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">processHeaders</span><span style="color:#999999;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">processCancel</span><span style="color:#999999;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">request</span><span style="color:#999999;">.</span><span style="color:#59873A;">send</span><span style="color:#999999;">(</span><span style="color:#B07D48;">data</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">configureRequest</span><span style="color:#999999;">():</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">void</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">responseType</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">request</span><span style="color:#999999;">.</span><span style="color:#B07D48;">responseType</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">responseType</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">timeout</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">request</span><span style="color:#999999;">.</span><span style="color:#B07D48;">timeout</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">timeout</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">withCredentials</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">request</span><span style="color:#999999;">.</span><span style="color:#B07D48;">withCredentials</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">withCredentials</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">addEvents</span><span style="color:#999999;">():</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">void</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#B07D48;">request</span><span style="color:#999999;">.</span><span style="color:#59873A;">onreadystatechange</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">handleLoad</span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">request</span><span style="color:#999999;">.</span><span style="color:#B07D48;">readyState</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">4</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#1E754F;">return</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">request</span><span style="color:#999999;">.</span><span style="color:#B07D48;">status</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#1E754F;">return</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#AB5959;">const </span><span style="color:#B07D48;">responseHeaders</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#59873A;">parseHeaders</span><span style="color:#999999;">(</span><span style="color:#B07D48;">request</span><span style="color:#999999;">.</span><span style="color:#59873A;">getAllResponseHeaders</span><span style="color:#999999;">())</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#AB5959;">const </span><span style="color:#B07D48;">responseData</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span></span>
<span class="line"><span style="color:#AB5959;">          </span><span style="color:#B07D48;">responseType</span><span style="color:#AB5959;"> &amp;&amp; </span><span style="color:#B07D48;">responseType</span><span style="color:#AB5959;"> !== </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">text</span><span style="color:#B56959AA;">&#39;</span><span style="color:#AB5959;"> ? </span><span style="color:#B07D48;">request</span><span style="color:#999999;">.</span><span style="color:#B07D48;">response</span><span style="color:#AB5959;"> : </span><span style="color:#B07D48;">request</span><span style="color:#999999;">.</span><span style="color:#B07D48;">responseText</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#AB5959;">const </span><span style="color:#B07D48;">response</span><span style="color:#999999;">: </span><span style="color:#2E808F;">AxiosResponse</span><span style="color:#999999;"> =</span><span style="color:#AB5959;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#AB5959;">          </span><span style="color:#998418;">data</span><span style="color:#999999;">:</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">responseData</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#AB5959;">          </span><span style="color:#998418;">status</span><span style="color:#999999;">:</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">request</span><span style="color:#999999;">.</span><span style="color:#B07D48;">status</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#AB5959;">          </span><span style="color:#998418;">statusText</span><span style="color:#999999;">:</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">request</span><span style="color:#999999;">.</span><span style="color:#B07D48;">statusText</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#AB5959;">          </span><span style="color:#998418;">headers</span><span style="color:#999999;">:</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">responseHeaders</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#AB5959;">          </span><span style="color:#B07D48;">config</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#AB5959;">          </span><span style="color:#B07D48;">request</span></span>
<span class="line"><span style="color:#AB5959;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#59873A;">handleResponse</span><span style="color:#999999;">(</span><span style="color:#B07D48;">response</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#B07D48;">request</span><span style="color:#999999;">.</span><span style="color:#59873A;">onerror</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">handleError</span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#59873A;">reject</span><span style="color:#999999;">(</span><span style="color:#59873A;">createError</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Network Error</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">config</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">request</span><span style="color:#999999;">))</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#B07D48;">request</span><span style="color:#999999;">.</span><span style="color:#59873A;">ontimeout</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">handleTimeout</span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#59873A;">reject</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#59873A;">createError</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">`</span><span style="color:#B56959;">Timeout of </span><span style="color:#999999;">${</span><span style="color:#B56959;">config</span><span style="color:#999999;">.</span><span style="color:#B56959;">timeout</span><span style="color:#999999;">}</span><span style="color:#B56959;"> ms exceeded</span><span style="color:#B56959AA;">`</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">config</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">ECONNABORTED</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">request</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">onDownloadProgress</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">request</span><span style="color:#999999;">.</span><span style="color:#B07D48;">onprogress</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">onDownloadProgress</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">onUploadProgress</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">request</span><span style="color:#999999;">.</span><span style="color:#B07D48;">upload</span><span style="color:#999999;">.</span><span style="color:#B07D48;">onprogress</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">onUploadProgress</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">processHeaders</span><span style="color:#999999;">():</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">void</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#59873A;">isFormData</span><span style="color:#999999;">(</span><span style="color:#B07D48;">data</span><span style="color:#999999;">))</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#AB5959;">delete</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">headers</span><span style="color:#999999;">[</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Content-Type</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">]</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">((</span><span style="color:#B07D48;">withCredentials</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">||</span><span style="color:#393A34;"> </span><span style="color:#59873A;">isURLSameOrigin</span><span style="color:#999999;">(</span><span style="color:#B07D48;">url</span><span style="color:#AB5959;">!</span><span style="color:#999999;">))</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;&amp;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">xsrfCookieName</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#AB5959;">const </span><span style="color:#B07D48;">xsrfValue</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">cookie</span><span style="color:#999999;">.</span><span style="color:#59873A;">read</span><span style="color:#999999;">(</span><span style="color:#B07D48;">xsrfCookieName</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">xsrfValue</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#B07D48;">headers</span><span style="color:#999999;">[</span><span style="color:#B07D48;">xsrfHeaderName</span><span style="color:#AB5959;">!</span><span style="color:#999999;">]</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">xsrfValue</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#B07D48;">Object</span><span style="color:#999999;">.</span><span style="color:#59873A;">keys</span><span style="color:#999999;">(</span><span style="color:#B07D48;">headers</span><span style="color:#999999;">).</span><span style="color:#59873A;">forEach</span><span style="color:#999999;">(</span><span style="color:#B07D48;">name</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">data</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;&amp;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">name</span><span style="color:#999999;">.</span><span style="color:#59873A;">toLowerCase</span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">content-type</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#AB5959;">delete</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">headers</span><span style="color:#999999;">[</span><span style="color:#B07D48;">name</span><span style="color:#999999;">]</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">else</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#B07D48;">request</span><span style="color:#999999;">.</span><span style="color:#59873A;">setRequestHeader</span><span style="color:#999999;">(</span><span style="color:#B07D48;">name</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">headers</span><span style="color:#999999;">[</span><span style="color:#B07D48;">name</span><span style="color:#999999;">])</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">processCancel</span><span style="color:#999999;">():</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">void</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">cancelToken</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">cancelToken</span><span style="color:#999999;">.</span><span style="color:#B07D48;">promise</span><span style="color:#999999;">.</span><span style="color:#59873A;">then</span><span style="color:#999999;">(</span><span style="color:#B07D48;">reason</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#B07D48;">request</span><span style="color:#999999;">.</span><span style="color:#59873A;">abort</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#59873A;">reject</span><span style="color:#999999;">(</span><span style="color:#B07D48;">reason</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">handleResponse</span><span style="color:#999999;">(</span><span style="color:#B07D48;">response</span><span style="color:#999999;">: </span><span style="color:#2E808F;">AxiosResponse</span><span style="color:#999999;">):</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">void</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">response</span><span style="color:#999999;">.</span><span style="color:#B07D48;">status</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&gt;=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">200</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;&amp;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">response</span><span style="color:#999999;">.</span><span style="color:#B07D48;">status</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">300</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#59873A;">resolve</span><span style="color:#999999;">(</span><span style="color:#B07D48;">response</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">else</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#59873A;">reject</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#59873A;">createError</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B56959AA;">`</span><span style="color:#B56959;">Request failed with status code </span><span style="color:#999999;">${</span><span style="color:#B56959;">response</span><span style="color:#999999;">.</span><span style="color:#B56959;">status</span><span style="color:#999999;">}</span><span style="color:#B56959AA;">`</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">config</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">request</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">response</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><p>我们把整个流程分为 7 步：</p><ul><li>创建一个 <code>request</code> 实例。</li><li>执行 <code>request.open</code> 方法初始化。</li><li>执行 <code>configureRequest</code> 配置 <code>request</code> 对象。</li><li>执行 <code>addEvents</code> 给 <code>request</code> 添加事件处理函数。</li><li>执行 <code>processHeaders</code> 处理请求 <code>headers</code>。</li><li>执行 <code>processCancel</code> 处理请求取消逻辑。</li><li>执行 <code>request.send</code> 方法发送请求。</li></ul><p>这样拆分后整个流程就会显得非常清晰，未来我们再去新增需求的时候代码也不会显得越来越臃肿。</p><h2 id="demo-编写" tabindex="-1">demo 编写 <a class="header-anchor" href="#demo-编写" aria-hidden="true">#</a></h2><p>这节课的 demo 非常有意思，我们第一次给界面上增加了一些交互的按钮。</p><p><code>examples/more/index.html</code></p><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#666666;">&lt;!</span><span style="color:#4D9375;">DOCTYPE</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">html</span><span style="color:#666666;">&gt;</span></span>
<span class="line"><span style="color:#666666;">&lt;</span><span style="color:#4D9375;">html</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">lang</span><span style="color:#666666;">=</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">en</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">&gt;</span></span>
<span class="line"><span style="color:#666666;">&lt;</span><span style="color:#4D9375;">head</span><span style="color:#666666;">&gt;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">&lt;</span><span style="color:#4D9375;">meta</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">charset</span><span style="color:#666666;">=</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">utf-8</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">&gt;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">&lt;</span><span style="color:#4D9375;">title</span><span style="color:#666666;">&gt;</span><span style="color:#DBD7CAEE;">More example</span><span style="color:#666666;">&lt;/</span><span style="color:#4D9375;">title</span><span style="color:#666666;">&gt;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">&lt;</span><span style="color:#4D9375;">link</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">rel</span><span style="color:#666666;">=</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">stylesheet</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">type</span><span style="color:#666666;">=</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">text/css</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">href</span><span style="color:#666666;">=</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">/&gt;</span></span>
<span class="line"><span style="color:#666666;">&lt;/</span><span style="color:#4D9375;">head</span><span style="color:#666666;">&gt;</span></span>
<span class="line"><span style="color:#666666;">&lt;</span><span style="color:#4D9375;">body</span><span style="color:#666666;">&gt;</span></span>
<span class="line"><span style="color:#666666;">&lt;</span><span style="color:#4D9375;">h1</span><span style="color:#666666;">&gt;</span><span style="color:#DBD7CAEE;">file download</span><span style="color:#666666;">&lt;/</span><span style="color:#4D9375;">h1</span><span style="color:#666666;">&gt;</span></span>
<span class="line"><span style="color:#666666;">&lt;</span><span style="color:#4D9375;">div</span><span style="color:#666666;">&gt;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">&lt;</span><span style="color:#4D9375;">button</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">id</span><span style="color:#666666;">=</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">download</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">class</span><span style="color:#666666;">=</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">btn btn-primary</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">&gt;</span><span style="color:#DBD7CAEE;">Download</span><span style="color:#666666;">&lt;/</span><span style="color:#4D9375;">button</span><span style="color:#666666;">&gt;</span></span>
<span class="line"><span style="color:#666666;">&lt;/</span><span style="color:#4D9375;">div</span><span style="color:#666666;">&gt;</span></span>
<span class="line"><span style="color:#666666;">&lt;</span><span style="color:#4D9375;">h1</span><span style="color:#666666;">&gt;</span><span style="color:#DBD7CAEE;">file upload</span><span style="color:#666666;">&lt;/</span><span style="color:#4D9375;">h1</span><span style="color:#666666;">&gt;</span></span>
<span class="line"><span style="color:#666666;">&lt;</span><span style="color:#4D9375;">form</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">role</span><span style="color:#666666;">=</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">form</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">class</span><span style="color:#666666;">=</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">form</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">onsubmit</span><span style="color:#666666;">=</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">false</span><span style="color:#666666;">;</span><span style="color:#DBD7CAEE;">&quot;</span><span style="color:#666666;">&gt;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">&lt;</span><span style="color:#4D9375;">input</span><span style="color:#666666;"> </span><span style="color:#BD976A;">id</span><span style="color:#666666;">=</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">file</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;"> </span><span style="color:#BD976A;">type</span><span style="color:#666666;">=</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">file</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;"> </span><span style="color:#BD976A;">class</span><span style="color:#666666;">=</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">form-control</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">/&gt;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">&lt;</span><span style="color:#4D9375;">button</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">id</span><span style="color:#666666;">=</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">upload</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">type</span><span style="color:#666666;">=</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">button</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">class</span><span style="color:#666666;">=</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">btn btn-primary</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">&gt;</span><span style="color:#DBD7CAEE;">Upload</span><span style="color:#666666;">&lt;/</span><span style="color:#4D9375;">button</span><span style="color:#666666;">&gt;</span></span>
<span class="line"><span style="color:#666666;">&lt;/</span><span style="color:#4D9375;">form</span><span style="color:#666666;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">&lt;</span><span style="color:#4D9375;">script</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">src</span><span style="color:#666666;">=</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">/__build__/more.js</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">&gt;&lt;/</span><span style="color:#4D9375;">script</span><span style="color:#666666;">&gt;</span></span>
<span class="line"><span style="color:#666666;">&lt;/</span><span style="color:#4D9375;">body</span><span style="color:#666666;">&gt;</span></span>
<span class="line"><span style="color:#666666;">&lt;/</span><span style="color:#4D9375;">html</span><span style="color:#666666;">&gt;</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#999999;">&lt;!</span><span style="color:#1E754F;">DOCTYPE</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">html</span><span style="color:#999999;">&gt;</span></span>
<span class="line"><span style="color:#999999;">&lt;</span><span style="color:#1E754F;">html</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">lang</span><span style="color:#999999;">=</span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">en</span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">&gt;</span></span>
<span class="line"><span style="color:#999999;">&lt;</span><span style="color:#1E754F;">head</span><span style="color:#999999;">&gt;</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">&lt;</span><span style="color:#1E754F;">meta</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">charset</span><span style="color:#999999;">=</span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">utf-8</span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">&gt;</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">&lt;</span><span style="color:#1E754F;">title</span><span style="color:#999999;">&gt;</span><span style="color:#393A34;">More example</span><span style="color:#999999;">&lt;/</span><span style="color:#1E754F;">title</span><span style="color:#999999;">&gt;</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">&lt;</span><span style="color:#1E754F;">link</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">rel</span><span style="color:#999999;">=</span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">stylesheet</span><span style="color:#B56959AA;">&quot;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">type</span><span style="color:#999999;">=</span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">text/css</span><span style="color:#B56959AA;">&quot;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">href</span><span style="color:#999999;">=</span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css</span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">/&gt;</span></span>
<span class="line"><span style="color:#999999;">&lt;/</span><span style="color:#1E754F;">head</span><span style="color:#999999;">&gt;</span></span>
<span class="line"><span style="color:#999999;">&lt;</span><span style="color:#1E754F;">body</span><span style="color:#999999;">&gt;</span></span>
<span class="line"><span style="color:#999999;">&lt;</span><span style="color:#1E754F;">h1</span><span style="color:#999999;">&gt;</span><span style="color:#393A34;">file download</span><span style="color:#999999;">&lt;/</span><span style="color:#1E754F;">h1</span><span style="color:#999999;">&gt;</span></span>
<span class="line"><span style="color:#999999;">&lt;</span><span style="color:#1E754F;">div</span><span style="color:#999999;">&gt;</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">&lt;</span><span style="color:#1E754F;">button</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">id</span><span style="color:#999999;">=</span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">download</span><span style="color:#B56959AA;">&quot;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">class</span><span style="color:#999999;">=</span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">btn btn-primary</span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">&gt;</span><span style="color:#393A34;">Download</span><span style="color:#999999;">&lt;/</span><span style="color:#1E754F;">button</span><span style="color:#999999;">&gt;</span></span>
<span class="line"><span style="color:#999999;">&lt;/</span><span style="color:#1E754F;">div</span><span style="color:#999999;">&gt;</span></span>
<span class="line"><span style="color:#999999;">&lt;</span><span style="color:#1E754F;">h1</span><span style="color:#999999;">&gt;</span><span style="color:#393A34;">file upload</span><span style="color:#999999;">&lt;/</span><span style="color:#1E754F;">h1</span><span style="color:#999999;">&gt;</span></span>
<span class="line"><span style="color:#999999;">&lt;</span><span style="color:#1E754F;">form</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">role</span><span style="color:#999999;">=</span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">form</span><span style="color:#B56959AA;">&quot;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">class</span><span style="color:#999999;">=</span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">form</span><span style="color:#B56959AA;">&quot;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">onsubmit</span><span style="color:#999999;">=</span><span style="color:#B56959AA;">&quot;</span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">false</span><span style="color:#999999;">;</span><span style="color:#393A34;">&quot;</span><span style="color:#999999;">&gt;</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">&lt;</span><span style="color:#1E754F;">input</span><span style="color:#999999;"> </span><span style="color:#B07D48;">id</span><span style="color:#999999;">=</span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">file</span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;"> </span><span style="color:#B07D48;">type</span><span style="color:#999999;">=</span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">file</span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;"> </span><span style="color:#B07D48;">class</span><span style="color:#999999;">=</span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">form-control</span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">/&gt;</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">&lt;</span><span style="color:#1E754F;">button</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">id</span><span style="color:#999999;">=</span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">upload</span><span style="color:#B56959AA;">&quot;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">type</span><span style="color:#999999;">=</span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">button</span><span style="color:#B56959AA;">&quot;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">class</span><span style="color:#999999;">=</span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">btn btn-primary</span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">&gt;</span><span style="color:#393A34;">Upload</span><span style="color:#999999;">&lt;/</span><span style="color:#1E754F;">button</span><span style="color:#999999;">&gt;</span></span>
<span class="line"><span style="color:#999999;">&lt;/</span><span style="color:#1E754F;">form</span><span style="color:#999999;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">&lt;</span><span style="color:#1E754F;">script</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">src</span><span style="color:#999999;">=</span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">/__build__/more.js</span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">&gt;&lt;/</span><span style="color:#1E754F;">script</span><span style="color:#999999;">&gt;</span></span>
<span class="line"><span style="color:#999999;">&lt;/</span><span style="color:#1E754F;">body</span><span style="color:#999999;">&gt;</span></span>
<span class="line"><span style="color:#999999;">&lt;/</span><span style="color:#1E754F;">html</span><span style="color:#999999;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>另外，我们为了友好地展示上传和下载进度，我们引入了一个开源库 <a href="https://github.com/rstacruz/nprogress" target="_blank" rel="noreferrer">nprogress</a>，它可以在页面的顶部展示进度条。</p><p><code>examples/more/app.ts</code>：</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#CB7676;">const </span><span style="color:#BD976A;">instance</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">axios</span><span style="color:#666666;">.</span><span style="color:#80A665;">create</span><span style="color:#666666;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">calculatePercentage</span><span style="color:#666666;">(</span><span style="color:#BD976A;">loaded</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">number</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">total</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">number</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Math</span><span style="color:#666666;">.</span><span style="color:#80A665;">floor</span><span style="color:#666666;">(</span><span style="color:#BD976A;">loaded</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">*</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">1.0</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">/</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">total</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">loadProgressBar</span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#CB7676;">const </span><span style="color:#80A665;">setupStartProgress</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#666666;">()</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#CB7676;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#CB7676;">    </span><span style="color:#BD976A;">instance</span><span style="color:#666666;">.</span><span style="color:#BD976A;">interceptors</span><span style="color:#666666;">.</span><span style="color:#BD976A;">request</span><span style="color:#666666;">.</span><span style="color:#80A665;">use</span><span style="color:#666666;">(</span><span style="color:#BD976A;">config</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#CB7676;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#CB7676;">      </span><span style="color:#BD976A;">NProgress</span><span style="color:#666666;">.</span><span style="color:#80A665;">start</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#CB7676;">      </span><span style="color:#4D9375;">return</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">config</span></span>
<span class="line"><span style="color:#CB7676;">    </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#CB7676;">  </span><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#CB7676;">const </span><span style="color:#80A665;">setupUpdateProgress</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#666666;">()</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#CB7676;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#CB7676;">    const </span><span style="color:#80A665;">update</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">e</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">ProgressEvent</span><span style="color:#666666;">)</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#CB7676;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#CB7676;">      </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#BD976A;">e</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#CB7676;">      </span><span style="color:#BD976A;">NProgress</span><span style="color:#666666;">.</span><span style="color:#80A665;">set</span><span style="color:#666666;">(</span><span style="color:#80A665;">calculatePercentage</span><span style="color:#666666;">(</span><span style="color:#BD976A;">e</span><span style="color:#666666;">.</span><span style="color:#BD976A;">loaded</span><span style="color:#666666;">,</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">e</span><span style="color:#666666;">.</span><span style="color:#BD976A;">total</span><span style="color:#666666;">))</span></span>
<span class="line"><span style="color:#CB7676;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#CB7676;">    </span><span style="color:#BD976A;">instance</span><span style="color:#666666;">.</span><span style="color:#BD976A;">defaults</span><span style="color:#666666;">.</span><span style="color:#BD976A;">onDownloadProgress</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">update</span></span>
<span class="line"><span style="color:#CB7676;">    </span><span style="color:#BD976A;">instance</span><span style="color:#666666;">.</span><span style="color:#BD976A;">defaults</span><span style="color:#666666;">.</span><span style="color:#BD976A;">onUploadProgress</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">update</span></span>
<span class="line"><span style="color:#CB7676;">  </span><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#CB7676;">const </span><span style="color:#80A665;">setupStopProgress</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#666666;">()</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#CB7676;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#CB7676;">    </span><span style="color:#BD976A;">instance</span><span style="color:#666666;">.</span><span style="color:#BD976A;">interceptors</span><span style="color:#666666;">.</span><span style="color:#BD976A;">response</span><span style="color:#666666;">.</span><span style="color:#80A665;">use</span><span style="color:#666666;">(</span><span style="color:#BD976A;">response</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#CB7676;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#CB7676;">      </span><span style="color:#BD976A;">NProgress</span><span style="color:#666666;">.</span><span style="color:#80A665;">done</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#CB7676;">      </span><span style="color:#4D9375;">return</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">response</span></span>
<span class="line"><span style="color:#CB7676;">    </span><span style="color:#666666;">},</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">error</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#CB7676;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#CB7676;">      </span><span style="color:#BD976A;">NProgress</span><span style="color:#666666;">.</span><span style="color:#80A665;">done</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#CB7676;">      </span><span style="color:#4D9375;">return</span><span style="color:#CB7676;"> </span><span style="color:#B8A965;">Promise</span><span style="color:#666666;">.</span><span style="color:#80A665;">reject</span><span style="color:#666666;">(</span><span style="color:#BD976A;">error</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#CB7676;">    </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#CB7676;">  </span><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">setupStartProgress</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">setupUpdateProgress</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">setupStopProgress</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#80A665;">loadProgressBar</span><span style="color:#666666;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676;">const </span><span style="color:#BD976A;">downloadEl</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">document</span><span style="color:#666666;">.</span><span style="color:#80A665;">getElementById</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">download</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">downloadEl</span><span style="color:#CB7676;">!</span><span style="color:#666666;">.</span><span style="color:#80A665;">addEventListener</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">click</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">e</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">instance</span><span style="color:#666666;">.</span><span style="color:#80A665;">get</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">https://img.mukewang.com/5cc01a7b0001a33718720632.jpg</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#666666;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676;">const </span><span style="color:#BD976A;">uploadEl</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">document</span><span style="color:#666666;">.</span><span style="color:#80A665;">getElementById</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">upload</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">uploadEl</span><span style="color:#CB7676;">!</span><span style="color:#666666;">.</span><span style="color:#80A665;">addEventListener</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">click</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">e</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#CB7676;">const </span><span style="color:#BD976A;">data</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> new </span><span style="color:#80A665;">FormData</span><span style="color:#666666;">()</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#CB7676;">const </span><span style="color:#BD976A;">fileEl</span><span style="color:#CB7676;"> </span><span style="color:#666666;">=</span><span style="color:#CB7676;"> </span><span style="color:#BD976A;">document</span><span style="color:#666666;">.</span><span style="color:#80A665;">getElementById</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">file</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span><span style="color:#CB7676;"> </span><span style="color:#4D9375;">as</span><span style="color:#CB7676;"> </span><span style="color:#5DA9A7;">HTMLInputElement</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">fileEl</span><span style="color:#666666;">.</span><span style="color:#BD976A;">files</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">data</span><span style="color:#666666;">.</span><span style="color:#80A665;">append</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">file</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">fileEl</span><span style="color:#666666;">.</span><span style="color:#BD976A;">files</span><span style="color:#666666;">[</span><span style="color:#4C9A91;">0</span><span style="color:#666666;">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">instance</span><span style="color:#666666;">.</span><span style="color:#80A665;">post</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">/more/upload</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">data</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">})</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#AB5959;">const </span><span style="color:#B07D48;">instance</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">axios</span><span style="color:#999999;">.</span><span style="color:#59873A;">create</span><span style="color:#999999;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">calculatePercentage</span><span style="color:#999999;">(</span><span style="color:#B07D48;">loaded</span><span style="color:#999999;">: </span><span style="color:#2E808F;">number</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">total</span><span style="color:#999999;">: </span><span style="color:#2E808F;">number</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Math</span><span style="color:#999999;">.</span><span style="color:#59873A;">floor</span><span style="color:#999999;">(</span><span style="color:#B07D48;">loaded</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">*</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">1.0</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">/</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">total</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">loadProgressBar</span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">const </span><span style="color:#59873A;">setupStartProgress</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#999999;">()</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#AB5959;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#AB5959;">    </span><span style="color:#B07D48;">instance</span><span style="color:#999999;">.</span><span style="color:#B07D48;">interceptors</span><span style="color:#999999;">.</span><span style="color:#B07D48;">request</span><span style="color:#999999;">.</span><span style="color:#59873A;">use</span><span style="color:#999999;">(</span><span style="color:#B07D48;">config</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#AB5959;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#AB5959;">      </span><span style="color:#B07D48;">NProgress</span><span style="color:#999999;">.</span><span style="color:#59873A;">start</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#AB5959;">      </span><span style="color:#1E754F;">return</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">config</span></span>
<span class="line"><span style="color:#AB5959;">    </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#AB5959;">  </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">const </span><span style="color:#59873A;">setupUpdateProgress</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#999999;">()</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#AB5959;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#AB5959;">    const </span><span style="color:#59873A;">update</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">e</span><span style="color:#999999;">: </span><span style="color:#2E808F;">ProgressEvent</span><span style="color:#999999;">)</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#AB5959;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#AB5959;">      </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B07D48;">e</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#AB5959;">      </span><span style="color:#B07D48;">NProgress</span><span style="color:#999999;">.</span><span style="color:#59873A;">set</span><span style="color:#999999;">(</span><span style="color:#59873A;">calculatePercentage</span><span style="color:#999999;">(</span><span style="color:#B07D48;">e</span><span style="color:#999999;">.</span><span style="color:#B07D48;">loaded</span><span style="color:#999999;">,</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">e</span><span style="color:#999999;">.</span><span style="color:#B07D48;">total</span><span style="color:#999999;">))</span></span>
<span class="line"><span style="color:#AB5959;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#AB5959;">    </span><span style="color:#B07D48;">instance</span><span style="color:#999999;">.</span><span style="color:#B07D48;">defaults</span><span style="color:#999999;">.</span><span style="color:#B07D48;">onDownloadProgress</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">update</span></span>
<span class="line"><span style="color:#AB5959;">    </span><span style="color:#B07D48;">instance</span><span style="color:#999999;">.</span><span style="color:#B07D48;">defaults</span><span style="color:#999999;">.</span><span style="color:#B07D48;">onUploadProgress</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">update</span></span>
<span class="line"><span style="color:#AB5959;">  </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">const </span><span style="color:#59873A;">setupStopProgress</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#999999;">()</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#AB5959;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#AB5959;">    </span><span style="color:#B07D48;">instance</span><span style="color:#999999;">.</span><span style="color:#B07D48;">interceptors</span><span style="color:#999999;">.</span><span style="color:#B07D48;">response</span><span style="color:#999999;">.</span><span style="color:#59873A;">use</span><span style="color:#999999;">(</span><span style="color:#B07D48;">response</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#AB5959;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#AB5959;">      </span><span style="color:#B07D48;">NProgress</span><span style="color:#999999;">.</span><span style="color:#59873A;">done</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#AB5959;">      </span><span style="color:#1E754F;">return</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">response</span></span>
<span class="line"><span style="color:#AB5959;">    </span><span style="color:#999999;">},</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">error</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#AB5959;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#AB5959;">      </span><span style="color:#B07D48;">NProgress</span><span style="color:#999999;">.</span><span style="color:#59873A;">done</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#AB5959;">      </span><span style="color:#1E754F;">return</span><span style="color:#AB5959;"> </span><span style="color:#998418;">Promise</span><span style="color:#999999;">.</span><span style="color:#59873A;">reject</span><span style="color:#999999;">(</span><span style="color:#B07D48;">error</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#AB5959;">    </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#AB5959;">  </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">setupStartProgress</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">setupUpdateProgress</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">setupStopProgress</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;">loadProgressBar</span><span style="color:#999999;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">const </span><span style="color:#B07D48;">downloadEl</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">document</span><span style="color:#999999;">.</span><span style="color:#59873A;">getElementById</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">download</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">downloadEl</span><span style="color:#AB5959;">!</span><span style="color:#999999;">.</span><span style="color:#59873A;">addEventListener</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">click</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">e</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">instance</span><span style="color:#999999;">.</span><span style="color:#59873A;">get</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">https://img.mukewang.com/5cc01a7b0001a33718720632.jpg</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#999999;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">const </span><span style="color:#B07D48;">uploadEl</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">document</span><span style="color:#999999;">.</span><span style="color:#59873A;">getElementById</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">upload</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">uploadEl</span><span style="color:#AB5959;">!</span><span style="color:#999999;">.</span><span style="color:#59873A;">addEventListener</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">click</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">e</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">const </span><span style="color:#B07D48;">data</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> new </span><span style="color:#59873A;">FormData</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">const </span><span style="color:#B07D48;">fileEl</span><span style="color:#AB5959;"> </span><span style="color:#999999;">=</span><span style="color:#AB5959;"> </span><span style="color:#B07D48;">document</span><span style="color:#999999;">.</span><span style="color:#59873A;">getElementById</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">file</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span><span style="color:#AB5959;"> </span><span style="color:#1E754F;">as</span><span style="color:#AB5959;"> </span><span style="color:#2E808F;">HTMLInputElement</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">fileEl</span><span style="color:#999999;">.</span><span style="color:#B07D48;">files</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">data</span><span style="color:#999999;">.</span><span style="color:#59873A;">append</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">file</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">fileEl</span><span style="color:#999999;">.</span><span style="color:#B07D48;">files</span><span style="color:#999999;">[</span><span style="color:#2F798A;">0</span><span style="color:#999999;">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">instance</span><span style="color:#999999;">.</span><span style="color:#59873A;">post</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">/more/upload</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">data</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">})</span></span>
<span class="line"></span></code></pre></div><p>对于 <code>progress</code> 事件参数 <code>e</code>，会有 <code>e.total</code> 和 <code>e.loaded</code> 属性，表示进程总体的工作量和已经执行的工作量，我们可以根据这 2 个值算出当前进度，然后通过 <code>Nprogess.set</code> 设置。另外，我们通过配置请求拦截器和响应拦截器执行 <code>NProgress.start()</code> 和 <code>NProgress.done()</code>。</p><p>我们给下载按钮绑定了一个 <code>click</code> 事件，请求一张图片，我们可以看到实时的进度；另外我们也给上传按钮绑定了一个 <code>click</code> 事件，上传我们选择的文件，同样也能看到实时进度。</p><p>在服务端，我们为了处理上传请求，需要下载安装一个 <code>express</code> 的中间件 <code>connect-multiparty</code>，然后使用它。</p><p><code>example/server.js</code>：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">multipart</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">require</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">connect-multiparty</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#BD976A;">app</span><span style="color:#666666;">.</span><span style="color:#80A665;">use</span><span style="color:#666666;">(</span><span style="color:#80A665;">multipart</span><span style="color:#666666;">({</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#B8A965;">uploadDir</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">path</span><span style="color:#666666;">.</span><span style="color:#80A665;">resolve</span><span style="color:#666666;">(</span><span style="color:#BD976A;">__dirname</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">upload-file</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#666666;">}))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">router</span><span style="color:#666666;">.</span><span style="color:#80A665;">post</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">/more/upload</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#666666;">(</span><span style="color:#BD976A;">req</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">res</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#BD976A;">req</span><span style="color:#666666;">.</span><span style="color:#BD976A;">body</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">req</span><span style="color:#666666;">.</span><span style="color:#BD976A;">files</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">res</span><span style="color:#666666;">.</span><span style="color:#80A665;">end</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">upload success!</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#666666;">})</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">multipart</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">require</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">connect-multiparty</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#B07D48;">app</span><span style="color:#999999;">.</span><span style="color:#59873A;">use</span><span style="color:#999999;">(</span><span style="color:#59873A;">multipart</span><span style="color:#999999;">({</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#998418;">uploadDir</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">path</span><span style="color:#999999;">.</span><span style="color:#59873A;">resolve</span><span style="color:#999999;">(</span><span style="color:#B07D48;">__dirname</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">upload-file</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#999999;">}))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">router</span><span style="color:#999999;">.</span><span style="color:#59873A;">post</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">/more/upload</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#999999;">(</span><span style="color:#B07D48;">req</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">res</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B07D48;">req</span><span style="color:#999999;">.</span><span style="color:#B07D48;">body</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">req</span><span style="color:#999999;">.</span><span style="color:#B07D48;">files</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">res</span><span style="color:#999999;">.</span><span style="color:#59873A;">end</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">upload success!</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#999999;">})</span></span>
<span class="line"></span></code></pre></div><p>这里我们需要在 <code>examples</code> 目录下创建一个 <code>upload-file</code> 的空目录，用于存放上传的文件。</p><p>通过这个中间件，我们就可以处理上传请求并且可以把上传的文件存储在 <code>upload-file</code> 目录下。</p><p>为了保证代码正常运行，我们还需要在 <code>examples/webpack.config.js</code> 中添加 <code>css-loader</code> 和 <code>css-loader</code>，不要忘记先安装它们。</p><p>至此，<code>ts-axios</code> 支持了上传下载进度事件的回调函数的配置，用户可以通过配置这俩函数实现对下载进度和上传进度的监控。下一节课我们来实现 http 的认证授权功能。</p></div></div></main><!--[--><!--]--><footer class="VPDocFooter" data-v-6b6fcb79 data-v-ae0105da><!----><div class="prev-next" data-v-ae0105da><div class="pager" data-v-ae0105da><a class="pager-link prev" href="/ts-axios-docs/guide/chapter10/xsrf.html" data-v-ae0105da><span class="desc" data-v-ae0105da>Previous page</span><span class="title" data-v-ae0105da>XSRF 防御</span></a></div><div class="has-prev pager" data-v-ae0105da><a class="pager-link next" href="/ts-axios-docs/guide/chapter10/auth.html" data-v-ae0105da><span class="desc" data-v-ae0105da>Next page</span><span class="title" data-v-ae0105da>HTTP 授权</span></a></div></div></footer><!--[--><!--]--></div></div></div></div></div><footer class="VPFooter has-sidebar" data-v-82528fa6 data-v-13fad65a><div class="container" data-v-13fad65a><p class="message" data-v-13fad65a>既然选择了远方，便只顾风雨兼程</p><p class="copyright" data-v-13fad65a>Copyright © 2022-future</p></div></footer><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"readme.md\":\"2f02d888\",\"components_coma.md\":\"92e59c4e\",\"components_comb.md\":\"e8b7fc43\",\"guide_chapter1_readme.md\":\"c257f764\",\"guide_chapter1_install.md\":\"2a81653f\",\"guide_chapter1_start.md\":\"3858bf61\",\"guide_chapter10_auth.md\":\"e1369c77\",\"guide_chapter10_baseurl.md\":\"90bc16e5\",\"guide_chapter10_paramsserializer.md\":\"0ab01448\",\"guide_chapter10_static.md\":\"e01ef34e\",\"guide_chapter10_upload-download.md\":\"e60fc092\",\"guide_chapter10_validatestatus.md\":\"d464480b\",\"guide_chapter10_withcredentials.md\":\"c9bbd937\",\"guide_chapter10_xsrf.md\":\"6addfa50\",\"guide_chapter11_cancel.md\":\"e081f8b3\",\"guide_chapter11_headers.md\":\"ffcd1fdb\",\"guide_chapter11_helpers.md\":\"809cb184\",\"guide_chapter11_instance.md\":\"67679fae\",\"guide_chapter11_interceptor.md\":\"26dd87a2\",\"guide_chapter11_jest.md\":\"6f4f6617\",\"guide_chapter11_mergeconfig.md\":\"d349eb38\",\"guide_chapter11_more.md\":\"cf2d85d9\",\"guide_chapter11_preface.md\":\"cc1a01ab\",\"guide_chapter11_requests.md\":\"43ae509d\",\"guide_chapter2_advance.md\":\"7de1cbdd\",\"guide_chapter2_class.md\":\"3a84b13a\",\"guide_chapter2_declare.md\":\"cc7314f0\",\"guide_chapter2_function.md\":\"19d14739\",\"guide_chapter2_generic.md\":\"3c2b107b\",\"guide_chapter2_inference.md\":\"5457208f\",\"guide_chapter2_interface.md\":\"0907ee19\",\"guide_chapter2_type.md\":\"2f620abf\",\"guide_chapter3_base.md\":\"fe347d6a\",\"guide_chapter3_init.md\":\"764df9f4\",\"guide_chapter3_require.md\":\"78650725\",\"guide_chapter4_data.md\":\"6843eb40\",\"guide_chapter4_header.md\":\"c2cc143c\",\"guide_chapter4_response-data.md\":\"f00b266c\",\"guide_chapter4_response-header.md\":\"8594b9f6\",\"guide_chapter4_response.md\":\"1be88542\",\"guide_chapter4_url.md\":\"641f73ff\",\"guide_chapter5_enhance.md\":\"c6979845\",\"guide_chapter5_error.md\":\"5141d36e\",\"guide_chapter6_extend.md\":\"3de4c6e7\",\"guide_chapter6_generic.md\":\"f7b12b61\",\"guide_chapter6_overload.md\":\"b8a4a9ed\",\"guide_chapter7_interceptor.md\":\"f3a582c3\",\"guide_chapter8_create.md\":\"58581c73\",\"guide_chapter8_merge.md\":\"62592357\",\"guide_chapter8_transform.md\":\"094e15ec\",\"guide_chapter9_cancel.md\":\"4df92b2c\",\"guide_index.md\":\"10ad4926\",\"guide_usage.md\":\"d7199f13\",\"index.md\":\"ecde4f7f\"}")</script>
    <script type="module" async src="/ts-axios-docs/assets/app.494a6664.js"></script>
    
  </body>
</html>